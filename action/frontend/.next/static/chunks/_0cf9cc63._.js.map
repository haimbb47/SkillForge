{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/components/WalletGuard.tsx"],"sourcesContent":["\"use client\";\n\nimport { ReactNode } from \"react\";\nimport { useMetaMaskEthersSigner } from \"@/hooks/metamask/useMetaMaskEthersSigner\";\n\nexport default function WalletGuard({ children }: { children: ReactNode }) {\n  const { isConnected, connect } = useMetaMaskEthersSigner();\n\n  if (!isConnected) {\n    return (\n      <div className=\"min-h-[calc(100vh-5rem)] flex items-center justify-center p-4\">\n        <div className=\"w-full max-w-md\">\n          <div className=\"glass-strong rounded-3xl p-10 shadow-glass-lg text-center\">\n            {/* Decorative background */}\n            <div className=\"absolute inset-0 bg-gradient-purple opacity-5 rounded-3xl blur-3xl\"></div>\n            \n            <div className=\"relative z-10\">\n              <div className=\"inline-flex h-24 w-24 items-center justify-center rounded-3xl bg-gradient-purple text-5xl mb-6 shadow-glow animate-float\">\n                ðŸ”—\n              </div>\n              <h2 className=\"text-3xl font-display font-black mb-3\">\n                <span className=\"gradient-text\">Connect Wallet</span>\n              </h2>\n              <div className=\"h-1 w-16 bg-gradient-purple mx-auto mb-6 rounded-full\"></div>\n              <p className=\"text-white/80 mb-8 leading-relaxed\">\n                Please connect your MetaMask wallet to access SkillForge\n              </p>\n              \n              <button\n                onClick={connect}\n                className=\"w-full py-4 glass-strong rounded-2xl font-bold shadow-glow hover:shadow-glow-cyan transition-all btn-glass group\"\n              >\n                <span className=\"flex items-center justify-center space-x-2\">\n                  <span>ðŸš€</span>\n                  <span>Connect MetaMask</span>\n                </span>\n              </button>\n              \n              <div className=\"mt-8 glass-dark rounded-2xl p-4\">\n                <div className=\"flex items-start space-x-3\">\n                  <span className=\"text-2xl\">ðŸ’¡</span>\n                  <p className=\"text-sm text-white/70 text-left\">\n                    Make sure you have MetaMask browser extension installed\n                  </p>\n                </div>\n              </div>\n\n              {/* Decorative elements */}\n              <div className=\"mt-8 flex items-center justify-center space-x-2\">\n                <div className=\"h-px w-12 bg-gradient-to-r from-transparent to-white/20\"></div>\n                <div className=\"flex space-x-1\">\n                  <div className=\"h-1.5 w-1.5 bg-primary rounded-full\"></div>\n                  <div className=\"h-1.5 w-1.5 bg-secondary rounded-full\"></div>\n                  <div className=\"h-1.5 w-1.5 bg-accent rounded-full\"></div>\n                </div>\n                <div className=\"h-px w-12 bg-gradient-to-l from-transparent to-white/20\"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n"],"names":[],"mappings":";;;;;AAGA;;;AAHA;;AAKe,SAAS,YAAY,KAAqC;QAArC,EAAE,QAAQ,EAA2B,GAArC;;IAClC,MAAM,EAAE,WAAW,EAAE,OAAO,EAAE,GAAG,IAAA,2KAAuB;IAExD,IAAI,CAAC,aAAa;QAChB,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;;sCAEb,6LAAC;4BAAI,WAAU;;;;;;sCAEf,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;8CAA2H;;;;;;8CAG1I,6LAAC;oCAAG,WAAU;8CACZ,cAAA,6LAAC;wCAAK,WAAU;kDAAgB;;;;;;;;;;;8CAElC,6LAAC;oCAAI,WAAU;;;;;;8CACf,6LAAC;oCAAE,WAAU;8CAAqC;;;;;;8CAIlD,6LAAC;oCACC,SAAS;oCACT,WAAU;8CAEV,cAAA,6LAAC;wCAAK,WAAU;;0DACd,6LAAC;0DAAK;;;;;;0DACN,6LAAC;0DAAK;;;;;;;;;;;;;;;;;8CAIV,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDAAK,WAAU;0DAAW;;;;;;0DAC3B,6LAAC;gDAAE,WAAU;0DAAkC;;;;;;;;;;;;;;;;;8CAOnD,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;;;;;;sDACf,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAI,WAAU;;;;;;8DACf,6LAAC;oDAAI,WAAU;;;;;;8DACf,6LAAC;oDAAI,WAAU;;;;;;;;;;;;sDAEjB,6LAAC;4CAAI,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAO7B;IAEA,qBAAO;kBAAG;;AACZ;GA5DwB;;QACW,2KAAuB;;;KADlC","debugId":null}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\n\n\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\nimport { SDK_CDN_URL } from \"./constants\";\n\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\n\nexport class RelayerSDKLoader {\n  private _trace?: TraceType;\n\n  constructor(options: { trace?: TraceType }) {\n    this._trace = options.trace;\n  }\n\n  public isLoaded() {\n    if (typeof window === \"undefined\") {\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\n    }\n    return isFhevmWindowType(window, this._trace);\n  }\n\n  public load(): Promise<void> {\n    console.log(\"[RelayerSDKLoader] load...\");\n    if (typeof window === \"undefined\") {\n      console.log(\"[RelayerSDKLoader] window === undefined\");\n      return Promise.reject(\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\n      );\n    }\n\n    if (\"relayerSDK\" in window) {\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\n      }\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve, reject) => {\n      const existingScript = document.querySelector(\n        `script[src=\"${SDK_CDN_URL}\"]`\n      );\n      if (existingScript) {\n        if (!isFhevmWindowType(window, this._trace)) {\n          reject(\n            new Error(\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\n            )\n          );\n        }\n        resolve();\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src = SDK_CDN_URL;\n      script.type = \"text/javascript\";\n      script.async = true;\n\n      script.onload = () => {\n        if (!isFhevmWindowType(window, this._trace)) {\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\n          reject(\n            new Error(\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\n            )\n          );\n        }\n        resolve();\n      };\n\n      script.onerror = () => {\n        console.log(\"[RelayerSDKLoader] script onerror... \");\n        reject(\n          new Error(\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\n          )\n        );\n      };\n\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\n      document.head.appendChild(script);\n      console.log(\"[RelayerSDKLoader] script added!\")\n    });\n  }\n}\n\nfunction isFhevmRelayerSDKType(\n  o: unknown,\n  trace?: TraceType\n): o is FhevmRelayerSDKType {\n  if (typeof o === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\n    return false;\n  }\n  if (o === null) {\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\n    return false;\n  }\n  if (typeof o !== \"object\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\n    return false;\n  }\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\n    return false;\n  }\n  if (\"__initialized__\" in o) {\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isFhevmWindowType(\n  win: unknown,\n  trace?: TraceType\n): win is FhevmWindowType {\n  if (typeof win === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\n    return false;\n  }\n  if (win === null) {\n    trace?.(\"RelayerSDKLoader: window object is null\");\n    return false;\n  }\n  if (typeof win !== \"object\") {\n    trace?.(\"RelayerSDKLoader: window is not an object\");\n    return false;\n  }\n  if (!(\"relayerSDK\" in win)) {\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\n    return false;\n  }\n  return isFhevmRelayerSDKType(win.relayerSDK);\n}\n\nfunction objHasProperty<\n  T extends object,\n  K extends PropertyKey,\n  V extends string\n>(\n  obj: T,\n  propertyName: K,\n  propertyType: V,\n  trace?: TraceType\n): obj is T &\n  Record<\n    K,\n    V extends \"string\"\n      ? string\n      : V extends \"number\"\n      ? number\n      : V extends \"object\"\n      ? object\n      : V extends \"boolean\"\n      ? boolean\n      : V extends \"function\"\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (...args: any[]) => any\n      : unknown\n  > {\n  if (!obj || typeof obj !== \"object\") {\n    return false;\n  }\n\n  if (!(propertyName in obj)) {\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\n    return false;\n  }\n\n  const value = (obj as Record<K, unknown>)[propertyName];\n\n  if (value === null || value === undefined) {\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\n    return false;\n  }\n\n  if (typeof value !== propertyType) {\n    trace?.(\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\n    );\n    return false;\n  }\n\n  return true;\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 383, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\n\ntype FhevmStoredPublicKey = {\n  publicKeyId: string;\n  publicKey: Uint8Array;\n};\n\ntype FhevmStoredPublicParams = {\n  publicParamsId: string;\n  publicParams: Uint8Array;\n};\n\ninterface PublicParamsDB extends DBSchema {\n  publicKeyStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicKey;\n    };\n  };\n  paramsStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicParams;\n    };\n  };\n}\n\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\n\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\n  if (__dbPromise) {\n    return __dbPromise;\n  }\n  if (typeof window === \"undefined\") {\n    return undefined;\n  }\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\n    upgrade(db) {\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\n      }\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\n      }\n    },\n  });\n  return __dbPromise;\n}\n\ntype FhevmInstanceConfigPublicKey = {\n  data: Uint8Array | null;\n  id: string | null;\n};\n\ntype FhevmInstanceConfigPublicParams = {\n  \"2048\": {\n    publicParamsId: string;\n    publicParams: Uint8Array;\n  };\n};\n\nfunction assertFhevmStoredPublicKey(\n  value: unknown\n): asserts value is FhevmStoredPublicKey | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicKey must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicKeyId\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\n  }\n  if (typeof value.publicKeyId !== \"string\") {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\n  }\n  if (!(\"publicKey\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\n  }\n  if (!(value.publicKey instanceof Uint8Array)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\n  }\n}\n\nfunction assertFhevmStoredPublicParams(\n  value: unknown\n): asserts value is FhevmStoredPublicParams | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicParams must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicParamsId\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\n  }\n  if (typeof value.publicParamsId !== \"string\") {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\n  }\n  if (!(\"publicParams\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\n  }\n  if (!(value.publicParams instanceof Uint8Array)) {\n    throw new Error(\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\n    );\n  }\n}\n\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\n  publicKey?: FhevmInstanceConfigPublicKey;\n  publicParams: FhevmInstanceConfigPublicParams | null;\n}> {\n  const db = await _getDB();\n  if (!db) {\n    return { publicParams: null };\n  }\n\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\n  try {\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\n    if (pk?.value) {\n      assertFhevmStoredPublicKey(pk.value);\n      storedPublicKey = pk.value;\n    }\n  } catch {\n    //\n  }\n\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\n  try {\n    const pp = await db.get(\"paramsStore\", aclAddress);\n    if (pp?.value) {\n      assertFhevmStoredPublicParams(pp.value);\n      storedPublicParams = pp.value;\n    }\n  } catch {\n    //\n  }\n\n  const publicKeyData = storedPublicKey?.publicKey;\n  const publicKeyId = storedPublicKey?.publicKeyId;\n  const publicParams = storedPublicParams\n    ? {\n        \"2048\": storedPublicParams,\n      }\n    : null;\n\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\n\n  if (publicKeyId && publicKeyData) {\n    publicKey = {\n      id: publicKeyId,\n      data: publicKeyData,\n    };\n  }\n\n  return {\n    ...(publicKey !== undefined && { publicKey }),\n    publicParams,\n  };\n}\n\nexport async function publicKeyStorageSet(\n  aclAddress: `0x${string}`,\n  publicKey: FhevmStoredPublicKey | null,\n  publicParams: FhevmStoredPublicParams | null\n) {\n  assertFhevmStoredPublicKey(publicKey);\n  assertFhevmStoredPublicParams(publicParams);\n\n  const db = await _getDB();\n  if (!db) {\n    return;\n  }\n\n  if (publicKey) {\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\n  }\n\n  if (publicParams) {\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\n  }\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 527, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\nimport type {\n  FhevmInitSDKOptions,\n  FhevmInitSDKType,\n  FhevmLoadSDKType,\n  FhevmWindowType,\n} from \"./fhevmTypes\";\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\nimport { FhevmInstance, FhevmInstanceConfig } from \"../../fhevmTypes\";\n\nexport class FhevmReactError extends Error {\n  code: string;\n  constructor(code: string, message?: string, options?: ErrorOptions) {\n    super(message, options);\n    this.code = code;\n    this.name = \"FhevmReactError\";\n  }\n}\n\nfunction throwFhevmError(\n  code: string,\n  message?: string,\n  cause?: unknown\n): never {\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\n}\n\nconst isFhevmInitialized = (): boolean => {\n  if (!isFhevmWindowType(window, console.log)) {\n    return false;\n  }\n  return window.relayerSDK.__initialized__ === true;\n};\n\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\n  const loader = new RelayerSDKLoader({ trace: console.log });\n  return loader.load();\n};\n\nconst fhevmInitSDK: FhevmInitSDKType = async (\n  options?: FhevmInitSDKOptions\n) => {\n  if (!isFhevmWindowType(window, console.log)) {\n    throw new Error(\"window.relayerSDK is not available\");\n  }\n  const result = await window.relayerSDK.initSDK(options);\n  window.relayerSDK.__initialized__ = result;\n  if (!result) {\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\n  }\n  return true;\n};\n\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\n  if (typeof a !== \"string\") {\n    return false;\n  }\n  if (!isAddress(a)) {\n    return false;\n  }\n  return true;\n}\n\nexport class FhevmAbortError extends Error {\n  constructor(message = \"FHEVM operation was cancelled\") {\n    super(message);\n    this.name = \"FhevmAbortError\";\n  }\n}\n\ntype FhevmRelayerStatusType =\n  | \"sdk-loading\"\n  | \"sdk-loaded\"\n  | \"sdk-initializing\"\n  | \"sdk-initialized\"\n  | \"creating\";\n\nasync function getChainId(\n  providerOrUrl: Eip1193Provider | string\n): Promise<number> {\n  if (typeof providerOrUrl === \"string\") {\n    const provider = new JsonRpcProvider(providerOrUrl);\n    return Number((await provider.getNetwork()).chainId);\n  }\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\n  return Number.parseInt(chainId as string, 16);\n}\n\nasync function getWeb3Client(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"web3_clientVersion\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"WEB3_CLIENTVERSION_ERROR\",\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\n  | {\n      ACLAddress: `0x${string}`;\n      InputVerifierAddress: `0x${string}`;\n      KMSVerifierAddress: `0x${string}`;\n    }\n  | undefined\n> {\n  const version = await getWeb3Client(rpcUrl);\n  if (\n    typeof version !== \"string\" ||\n    !version.toLowerCase().includes(\"hardhat\")\n  ) {\n    return undefined;\n  }\n  try {\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\n    if (!metadata || typeof metadata !== \"object\") {\n      return undefined;\n    }\n    if (\n      !(\n        \"ACLAddress\" in metadata &&\n        typeof metadata.ACLAddress === \"string\" &&\n        metadata.ACLAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"InputVerifierAddress\" in metadata &&\n        typeof metadata.InputVerifierAddress === \"string\" &&\n        metadata.InputVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"KMSVerifierAddress\" in metadata &&\n        typeof metadata.KMSVerifierAddress === \"string\" &&\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    return metadata;\n  } catch {\n    return undefined;\n  }\n}\n\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"FHEVM_RELAYER_METADATA_ERROR\",\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\ntype ResolveResult = MockResolveResult | GenericResolveResult;\n\nasync function resolve(\n  providerOrUrl: Eip1193Provider | string,\n  mockChains?: Record<number, string>\n): Promise<ResolveResult> {\n  const chainId = await getChainId(providerOrUrl);\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\n\n  const _mockChains: Record<number, string> = {\n    31337: \"http://localhost:8545\",\n    ...(mockChains ?? {}),\n  };\n\n  if (Object.hasOwn(_mockChains, chainId)) {\n    if (!rpcUrl) {\n      rpcUrl = _mockChains[chainId];\n    }\n    return { isMock: true, chainId, rpcUrl };\n  }\n\n  return { isMock: false, chainId, rpcUrl };\n}\n\nexport const createFhevmInstance = async (parameters: {\n  provider: Eip1193Provider | string;\n  mockChains?: Record<number, string>;\n  signal: AbortSignal;\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\n}): Promise<FhevmInstance> => {\n  const throwIfAborted = () => {\n    if (signal.aborted) throw new FhevmAbortError();\n  };\n\n  const notify = (status: FhevmRelayerStatusType) => {\n    if (onStatusChange) onStatusChange(status);\n  };\n\n  const {\n    signal,\n    onStatusChange,\n    provider: providerOrUrl,\n    mockChains,\n  } = parameters;\n\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\n\n  if (isMock) {\n    const fhevmRelayerMetadata =\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\n\n    if (fhevmRelayerMetadata) {\n      notify(\"creating\");\n\n      const fhevmMock = await import(\"./mock/fhevmMock\");\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\n        rpcUrl,\n        chainId,\n        metadata: fhevmRelayerMetadata,\n      });\n\n      throwIfAborted();\n      return mockInstance;\n    }\n  }\n\n  throwIfAborted();\n\n  if (!isFhevmWindowType(window, console.log)) {\n    notify(\"sdk-loading\");\n    await fhevmLoadSDK();\n    throwIfAborted();\n    notify(\"sdk-loaded\");\n  }\n\n  if (!isFhevmInitialized()) {\n    notify(\"sdk-initializing\");\n    await fhevmInitSDK();\n    throwIfAborted();\n    notify(\"sdk-initialized\");\n  }\n\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\n\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\n  if (!checkIsAddress(aclAddress)) {\n    throw new Error(`Invalid address: ${aclAddress}`);\n  }\n\n  const pub = await publicKeyStorageGet(aclAddress);\n  throwIfAborted();\n\n  const config: FhevmInstanceConfig = {\n    ...relayerSDK.SepoliaConfig,\n    network: providerOrUrl,\n    publicKey: pub.publicKey,\n    publicParams: pub.publicParams,\n  };\n\n  notify(\"creating\");\n\n  const instance = await relayerSDK.createInstance(config);\n\n  await publicKeyStorageSet(\n    aclAddress,\n    instance.getPublicKey(),\n    instance.getPublicParams(2048)\n  );\n\n  throwIfAborted();\n\n  return instance;\n};\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 735, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport type { FhevmInstance } from \"./fhevmTypes\";\nimport { createFhevmInstance } from \"./internal/fhevm\";\n\nfunction _assert(condition: boolean, message?: string): asserts condition {\n  if (!condition) {\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\n    console.error(m);\n    throw new Error(m);\n  }\n}\n\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\n\nexport function useFhevm(parameters: {\n  provider: string | ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  enabled?: boolean;\n  initialMockChains?: Readonly<Record<number, string>>;\n}): {\n  instance: FhevmInstance | undefined;\n  refresh: () => void;\n  error: Error | undefined;\n  status: FhevmGoState;\n} {\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\n\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\n    undefined\n  );\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\n  const [error, _setError] = useState<Error | undefined>(undefined);\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\n  const _abortControllerRef = useRef<AbortController | null>(null);\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\n    provider\n  );\n  const _chainIdRef = useRef<number | undefined>(chainId);\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\n    initialMockChains\n  );\n\n  const refresh = useCallback(() => {\n    if (_abortControllerRef.current) {\n      _providerRef.current = undefined;\n      _chainIdRef.current = undefined;\n      _abortControllerRef.current.abort();\n      _abortControllerRef.current = null;\n    }\n\n    _providerRef.current = provider;\n    _chainIdRef.current = chainId;\n\n    _setInstance(undefined);\n    _setError(undefined);\n    _setStatus(\"idle\");\n\n    if (provider !== undefined) {\n      _setProviderChanged((prev) => prev + 1);\n    }\n  }, [provider, chainId]);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  useEffect(() => {\n    _setIsRunning(enabled);\n  }, [enabled]);\n\n  useEffect(() => {\n    if (_isRunning === false) {\n      if (_abortControllerRef.current) {\n        _abortControllerRef.current.abort();\n        _abortControllerRef.current = null;\n      }\n      _setInstance(undefined);\n      _setError(undefined);\n      _setStatus(\"idle\");\n      return;\n    }\n\n    if (_isRunning === true) {\n      if (_providerRef.current === undefined) {\n        _setInstance(undefined);\n        _setError(undefined);\n        _setStatus(\"idle\");\n        return;\n      }\n\n      if (!_abortControllerRef.current) {\n        _abortControllerRef.current = new AbortController();\n      }\n\n      _assert(\n        !_abortControllerRef.current.signal.aborted,\n        \"!controllerRef.current.signal.aborted\"\n      );\n\n      _setStatus(\"loading\");\n      _setError(undefined);\n\n      const thisSignal = _abortControllerRef.current.signal;\n      const thisProvider = _providerRef.current;\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\n\n      createFhevmInstance({\n        signal: thisSignal,\n        provider: thisProvider,\n        mockChains: thisRpcUrlsByChainId,\n        onStatusChange: (s) =>\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\n      })\n        .then((i) => {\n          console.log(`[useFhevm] createFhevmInstance created!`);\n          if (thisSignal.aborted) return;\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(i);\n          _setError(undefined);\n          _setStatus(\"ready\");\n        })\n        .catch((e) => {\n          console.log(`Error Was thrown !!! error... ` + e.name);\n          if (thisSignal.aborted) return;\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(undefined);\n          _setError(e);\n          _setStatus(\"error\");\n        });\n    }\n  }, [_isRunning, _providerChanged]);\n\n  return { instance, refresh, error, status };\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 875, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/GenericStringStorage.ts"],"sourcesContent":["export interface GenericStringStorage {\n  getItem(key: string): string | Promise<string | null> | null;\n  setItem(key: string, value: string): void | Promise<void>;\n  removeItem(key: string): void | Promise<void>;\n}\n\nexport class GenericStringInMemoryStorage implements GenericStringStorage {\n  #store = new Map<string, string>();\n\n  getItem(key: string): string | Promise<string | null> | null {\n    return this.#store.has(key) ? this.#store.get(key)! : null;\n  }\n  setItem(key: string, value: string): void | Promise<void> {\n    this.#store.set(key, value);\n  }\n  removeItem(key: string): void | Promise<void> {\n    this.#store.delete(key);\n  }\n}\n"],"names":[],"mappings":";;;;;;;;IAOE;AADK,MAAM;IAGX,QAAQ,GAAW,EAA0C;QAC3D,OAAO,iLAAA,IAAI,EAAC,QAAO,GAAG,CAAC,OAAO,iLAAA,IAAI,EAAC,QAAO,GAAG,CAAC,OAAQ;IACxD;IACA,QAAQ,GAAW,EAAE,KAAa,EAAwB;QACxD,iLAAA,IAAI,EAAC,QAAO,GAAG,CAAC,KAAK;IACvB;IACA,WAAW,GAAW,EAAwB;QAC5C,iLAAA,IAAI,EAAC,QAAO,MAAM,CAAC;IACrB;;QAVA,wLAAA;;mBAAS,IAAI;;;AAWf","debugId":null}},
    {"offset": {"line": 908, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/hooks/useInMemoryStorage.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo } from \"react\";\nimport {\n  GenericStringInMemoryStorage,\n  GenericStringStorage,\n} from \"@/fhevm/GenericStringStorage\";\n\nexport function useInMemoryStorage(): {\n  storage: GenericStringStorage;\n} {\n  const storage = useMemo(() => new GenericStringInMemoryStorage(), []);\n  return { storage };\n}\n\n\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAQO,SAAS;;IAGd,MAAM,UAAU,IAAA,wKAAO;+CAAC,IAAM,IAAI,gKAA4B;8CAAI,EAAE;IACpE,OAAO;QAAE;IAAQ;AACnB;GALgB","debugId":null}},
    {"offset": {"line": 935, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\nimport {\n  EIP712Type,\n  FhevmDecryptionSignatureType,\n  FhevmInstance,\n} from \"./fhevmTypes\";\nimport { GenericStringStorage } from \"./GenericStringStorage\";\n\nfunction _timestampNow(): number {\n  return Math.floor(Date.now() / 1000);\n}\n\nclass FhevmDecryptionSignatureStorageKey {\n  #contractAddresses: `0x${string}`[];\n  #userAddress: `0x${string}`;\n  #publicKey: string | undefined;\n  #key: string;\n\n  constructor(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ) {\n    if (!ethers.isAddress(userAddress)) {\n      throw new TypeError(`Invalid address ${userAddress}`);\n    }\n\n    const sortedContractAddresses = (\n      contractAddresses as `0x${string}`[]\n    ).sort();\n\n    const emptyEIP712 = instance.createEIP712(\n      publicKey ?? ethers.ZeroAddress,\n      sortedContractAddresses,\n      0,\n      0\n    );\n\n    try {\n      const hash = ethers.TypedDataEncoder.hash(\n        emptyEIP712.domain,\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\n        emptyEIP712.message\n      );\n\n      this.#contractAddresses = sortedContractAddresses;\n      this.#userAddress = userAddress as `0x${string}`;\n      this.#key = `${userAddress}:${hash}`;\n    } catch (e) {\n      console.log(e);\n      throw e;\n    }\n  }\n\n  get contractAddresses(): `0x${string}`[] {\n    return this.#contractAddresses;\n  }\n\n  get userAddress(): `0x${string}` {\n    return this.#userAddress;\n  }\n\n  get publicKey(): string | undefined {\n    return this.#publicKey;\n  }\n\n  get key(): string {\n    return this.#key;\n  }\n}\n\nexport class FhevmDecryptionSignature {\n  #publicKey: string;\n  #privateKey: string;\n  #signature: string;\n  #startTimestamp: number;\n  #durationDays: number;\n  #userAddress: `0x${string}`;\n  #contractAddresses: `0x${string}`[];\n  #eip712: EIP712Type;\n\n  private constructor(parameters: FhevmDecryptionSignatureType) {\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\n    }\n    this.#publicKey = parameters.publicKey;\n    this.#privateKey = parameters.privateKey;\n    this.#signature = parameters.signature;\n    this.#startTimestamp = parameters.startTimestamp;\n    this.#durationDays = parameters.durationDays;\n    this.#userAddress = parameters.userAddress;\n    this.#contractAddresses = parameters.contractAddresses;\n    this.#eip712 = parameters.eip712;\n  }\n\n  public get privateKey() {\n    return this.#privateKey;\n  }\n\n  public get publicKey() {\n    return this.#publicKey;\n  }\n\n  public get signature() {\n    return this.#signature;\n  }\n\n  public get contractAddresses() {\n    return this.#contractAddresses;\n  }\n\n  public get startTimestamp() {\n    return this.#startTimestamp;\n  }\n\n  public get durationDays() {\n    return this.#durationDays;\n  }\n\n  public get userAddress() {\n    return this.#userAddress;\n  }\n\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\n    if (!s || typeof s !== \"object\") {\n      return false;\n    }\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\n      return false;\n    }\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\n      return false;\n    }\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\n      return false;\n    }\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\n      return false;\n    }\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\n      return false;\n    }\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\n      return false;\n    }\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\n    }\n    if (\n      !(\n        \"userAddress\" in s &&\n        typeof s.userAddress === \"string\" &&\n        s.userAddress.startsWith(\"0x\")\n      )\n    ) {\n      return false;\n    }\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\n      return false;\n    }\n\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\n      return false;\n    }\n    if (\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\n    ) {\n      return false;\n    }\n    if (!(\"message\" in s.eip712)) {\n      return false;\n    }\n    if (\n      !(\n        \"types\" in s.eip712 &&\n        typeof s.eip712.types === \"object\" &&\n        s.eip712.types !== null\n      )\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  toJSON() {\n    return {\n      publicKey: this.#publicKey,\n      privateKey: this.#privateKey,\n      signature: this.#signature,\n      startTimestamp: this.#startTimestamp,\n      durationDays: this.#durationDays,\n      userAddress: this.#userAddress,\n      contractAddresses: this.#contractAddresses,\n      eip712: this.#eip712,\n    };\n  }\n\n  static fromJSON(json: unknown) {\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\n    return new FhevmDecryptionSignature(data);\n  }\n\n  isValid(): boolean {\n    return (\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\n    );\n  }\n\n  async saveToGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    withPublicKey: boolean\n  ) {\n    try {\n      const value = JSON.stringify(this);\n\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        this.#contractAddresses,\n        this.#userAddress,\n        withPublicKey ? this.#publicKey : undefined\n      );\n      await storage.setItem(storageKey.key, value);\n      console.log(\n        `signature saved! contracts=${this.#contractAddresses.length}`\n      );\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\n      );\n    }\n  }\n\n  static async loadFromGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        contractAddresses,\n        userAddress,\n        publicKey\n      );\n\n      const result = await storage.getItem(storageKey.key);\n\n      if (!result) {\n        console.warn(`Could not load signature! key=${storageKey.key}`);\n        return null;\n      }\n\n      try {\n        const kps = FhevmDecryptionSignature.fromJSON(result);\n        if (!kps.isValid()) {\n          return null;\n        }\n\n        return kps;\n      } catch {\n        return null;\n      }\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\n      );\n      return null;\n    }\n  }\n\n  static async new(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    publicKey: string,\n    privateKey: string,\n    signer: ethers.Signer\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\n      const startTimestamp = _timestampNow();\n      const durationDays = 365;\n      const eip712 = instance.createEIP712(\n        publicKey,\n        contractAddresses,\n        startTimestamp,\n        durationDays\n      );\n      const signature = await signer.signTypedData(\n        eip712.domain,\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\n        eip712.message\n      );\n      return new FhevmDecryptionSignature({\n        publicKey,\n        privateKey,\n        contractAddresses: contractAddresses as `0x${string}`[],\n        startTimestamp,\n        durationDays,\n        signature,\n        eip712: eip712 as EIP712Type,\n        userAddress,\n      });\n    } catch {\n      return null;\n    }\n  }\n\n  static async loadOrSign(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    signer: ethers.Signer,\n    storage: GenericStringStorage,\n    keyPair?: { publicKey: string; privateKey: string }\n  ): Promise<FhevmDecryptionSignature | null> {\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\n\n    const cached: FhevmDecryptionSignature | null =\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\n        storage,\n        instance,\n        contractAddresses,\n        userAddress,\n        keyPair?.publicKey\n      );\n\n    if (cached) {\n      return cached;\n    }\n\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\n\n    const sig = await FhevmDecryptionSignature.new(\n      instance,\n      contractAddresses,\n      publicKey,\n      privateKey,\n      signer\n    );\n\n    if (!sig) {\n      return null;\n    }\n\n    await sig.saveToGenericStringStorage(\n      storage,\n      instance,\n      Boolean(keyPair?.publicKey)\n    );\n\n    return sig;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1209, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/hooks/useSkillForge.tsx"],"sourcesContent":["\"use client\";\n\nimport { ethers } from \"ethers\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\n\n// è¾…åŠ©å‡½æ•°ï¼šå°†handleè½¬æ¢ä¸ºbytes32æ ¼å¼\nfunction convertHandleToBytes32(handle: any): string {\n  if (Array.isArray(handle)) {\n    const uint8Array = new Uint8Array(handle);\n    const hexString = ethers.hexlify(uint8Array);\n    return ethers.zeroPadValue(hexString, 32);\n  } else if (handle instanceof Uint8Array) {\n    const hexString = ethers.hexlify(handle);\n    return ethers.zeroPadValue(hexString, 32);\n  } else if (typeof handle === 'string') {\n    let hexString = handle;\n    if (!hexString.startsWith('0x')) {\n      hexString = '0x' + hexString;\n    }\n    if (hexString.length < 66) {\n      return ethers.zeroPadValue(hexString, 32);\n    }\n    return hexString;\n  }\n  throw new Error(`Unsupported handle type: ${typeof handle}, value: ${JSON.stringify(handle)}`);\n}\n\n// SkillForge åˆçº¦ ABI\nconst SKILLFORGE_ABI = [\n  \"function forgeCourse(string courseCID, bytes32 encryptedTotalChallenges, bytes inputProof) returns (uint256)\",\n  \"function submitProof(uint256 courseId, uint256 challengeId, string proofCID, bytes32 encryptedScore, bytes inputProof) returns (uint256)\",\n  \"function validateProof(uint256 proofId, uint8 status, bytes32 newEncryptedScore, bytes inputProof)\",\n  \"function claimBadge(uint256 courseId, string badgeCID, bytes32 encryptedTotalScore, bytes inputProof) returns (uint256)\",\n  \"function getCourse(uint256 courseId) view returns (address creator, string courseCID, bool active, uint256 forgedAt)\",\n  \"function getProof(uint256 proofId) view returns (uint256 courseId, uint256 challengeId, address learner, string proofCID, uint8 status, address validator, uint256 submittedAt)\",\n  \"function getProofEncryptedScore(uint256 proofId) view returns (bytes32 encryptedScoreHandle)\",\n  \"function getBadge(uint256 badgeId) view returns (uint256 courseId, address earner, string badgeCID, uint256 claimedAt)\",\n  \"function getBadgeEncryptedScore(uint256 badgeId) view returns (bytes32 encryptedTotalScoreHandle)\",\n  \"function nextProofId() view returns (uint256)\",\n  \"function nextBadgeId() view returns (uint256)\",\n  \"function grantValidatorRole(address validator, bool authorized)\",\n  \"function authorizedValidators(address) view returns (bool)\",\n  \"event CourseForged(uint256 indexed courseId, address indexed creator, string courseCID)\",\n  \"event ProofSubmitted(uint256 indexed proofId, uint256 indexed courseId, address indexed learner, string proofCID)\",\n  \"event ProofValidated(uint256 indexed proofId, address indexed validator, uint8 status)\",\n  \"event BadgeClaimed(uint256 indexed badgeId, uint256 indexed courseId, address indexed earner, string badgeCID)\",\n] as const;\n\nexport function useSkillForge(parameters: {\n  instance: FhevmInstance | undefined;\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\n  contractAddress: `0x${string}` | undefined;\n  ethersSigner: ethers.JsonRpcSigner | undefined;\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\n  chainId: number | undefined;\n}) {\n  const {\n    instance,\n    fhevmDecryptionSignatureStorage,\n    contractAddress,\n    ethersSigner,\n    ethersReadonlyProvider,\n    chainId,\n  } = parameters;\n\n  const [message, setMessage] = useState<string>(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n\n  const contract = useMemo(() => {\n    if (!contractAddress || !ethersReadonlyProvider) return undefined;\n    return new ethers.Contract(contractAddress, SKILLFORGE_ABI, ethersReadonlyProvider);\n  }, [contractAddress, ethersReadonlyProvider]);\n\n  const contractWithSigner = useMemo(() => {\n    if (!contractAddress || !ethersSigner) return undefined;\n    return new ethers.Contract(contractAddress, SKILLFORGE_ABI, ethersSigner);\n  }, [contractAddress, ethersSigner]);\n\n  // é”»é€ è¯¾ç¨‹\n  const forgeCourse = useCallback(\n    async (courseCID: string, totalChallenges: number) => {\n      if (!instance || !contractWithSigner || !ethersSigner) {\n        setMessage(\"FHEVMå®žä¾‹æˆ–åˆçº¦æœªå°±ç»ª\");\n        return;\n      }\n\n      setIsLoading(true);\n      setMessage(\"âš¡ æ­£åœ¨åŠ å¯†è¯¾ç¨‹æ•°æ®...\");\n\n      try {\n        const input = instance.createEncryptedInput(\n          contractAddress!,\n          await ethersSigner.getAddress()\n        );\n        input.add32(BigInt(totalChallenges));\n\n        const enc = await input.encrypt();\n\n        setMessage(\"ðŸ”¨ æ­£åœ¨æäº¤é”»é€ äº¤æ˜“...\");\n        \n        const handle = convertHandleToBytes32(enc.handles[0]);\n\n        const tx = await contractWithSigner.forgeCourse(\n          courseCID,\n          handle,\n          enc.inputProof,\n          { gasLimit: 10000000 }\n        );\n\n        setMessage(`â³ äº¤æ˜“å·²å‘é€: ${tx.hash}`);\n        const receipt = await tx.wait();\n        setMessage(`âœ… è¯¾ç¨‹é”»é€ æˆåŠŸï¼çŠ¶æ€: ${receipt?.status}`);\n      } catch (error: any) {\n        console.error(\"ForgeCourse error:\", error);\n        const errorMsg = error?.reason || error?.message || \"æœªçŸ¥é”™è¯¯\";\n        setMessage(`âŒ é”™è¯¯: ${errorMsg}`);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [instance, contractWithSigner, contractAddress, ethersSigner]\n  );\n\n  // æäº¤è¯æ˜Ž\n  const submitProof = useCallback(\n    async (\n      courseId: number,\n      challengeId: number,\n      proofCID: string,\n      score: number\n    ) => {\n      if (!instance || !contractWithSigner || !ethersSigner) {\n        setMessage(\"FHEVMå®žä¾‹æˆ–åˆçº¦æœªå°±ç»ª\");\n        return;\n      }\n\n      setIsLoading(true);\n      setMessage(\"âš¡ æ­£åœ¨åŠ å¯†åˆ†æ•°...\");\n\n      try {\n        const input = instance.createEncryptedInput(\n          contractAddress!,\n          await ethersSigner.getAddress()\n        );\n        input.add32(BigInt(score));\n\n        const enc = await input.encrypt();\n\n        setMessage(\"âš”ï¸ æ­£åœ¨æäº¤è¯æ˜Ž...\");\n        \n        const handle = convertHandleToBytes32(enc.handles[0]);\n\n        const tx = await contractWithSigner.submitProof(\n          courseId,\n          challengeId,\n          proofCID,\n          handle,\n          enc.inputProof,\n          { gasLimit: 10000000 }\n        );\n\n        setMessage(`â³ äº¤æ˜“å·²å‘é€: ${tx.hash}`);\n        const receipt = await tx.wait();\n        setMessage(`âœ… è¯æ˜Žæäº¤æˆåŠŸï¼çŠ¶æ€: ${receipt?.status}`);\n      } catch (error: any) {\n        console.error(\"SubmitProof error:\", error);\n        const errorMsg = error?.reason || error?.message || \"æœªçŸ¥é”™è¯¯\";\n        setMessage(`âŒ é”™è¯¯: ${errorMsg}`);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [instance, contractWithSigner, contractAddress, ethersSigner]\n  );\n\n  // éªŒè¯è¯æ˜Ž\n  const validateProof = useCallback(\n    async (proofId: number, status: number, newScore: number) => {\n      if (!instance || !contractWithSigner || !ethersSigner) {\n        setMessage(\"FHEVMå®žä¾‹æˆ–åˆçº¦æœªå°±ç»ª\");\n        return;\n      }\n\n      setIsLoading(true);\n      setMessage(\"ðŸ›¡ï¸ æ£€æŸ¥è¯æ˜ŽçŠ¶æ€...\");\n\n      try {\n        // å…ˆæ£€æŸ¥è¯æ˜ŽçŠ¶æ€\n        const proof = await contractWithSigner.getProof(proofId);\n        const proofStatus = Number(proof[4]); // statusæ˜¯ç¬¬5ä¸ªè¿”å›žå€¼\n        \n        if (proofStatus !== 0) {\n          throw new Error(`è¯æ˜Žå·²è¢«éªŒè¯ï¼ˆå½“å‰çŠ¶æ€: ${proofStatus === 1 ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»'}ï¼‰`);\n        }\n\n        setMessage(\"âš¡ åŠ å¯†æ–°åˆ†æ•°...\");\n\n        const input = instance.createEncryptedInput(\n          contractAddress!,\n          await ethersSigner.getAddress()\n        );\n        input.add32(BigInt(newScore));\n\n        const enc = await input.encrypt();\n\n        setMessage(\"ðŸ›¡ï¸ æäº¤éªŒè¯äº¤æ˜“...\");\n        \n        const handle = convertHandleToBytes32(enc.handles[0]);\n\n        const tx = await contractWithSigner.validateProof(\n          proofId,\n          status,\n          handle,\n          enc.inputProof,\n          { gasLimit: 10000000 }\n        );\n\n        setMessage(`â³ äº¤æ˜“å·²å‘é€: ${tx.hash}`);\n        const receipt = await tx.wait();\n        setMessage(`âœ… éªŒè¯æˆåŠŸï¼çŠ¶æ€: ${receipt?.status === 1 ? 'æˆåŠŸ' : 'å¤±è´¥'}`);\n      } catch (error: any) {\n        console.error(\"ValidateProof error:\", error);\n        let errorMsg = \"æœªçŸ¥é”™è¯¯\";\n        \n        if (error?.reason) {\n          errorMsg = error.reason;\n        } else if (error?.message) {\n          errorMsg = error.message;\n          if (errorMsg.includes(\"Not authorized\")) {\n            errorMsg = \"é”™è¯¯ï¼šæ‚¨æœªè¢«æŽˆæƒä¸ºéªŒè¯è€…ï¼Œè¯·å…ˆæŽˆæƒ\";\n          } else if (errorMsg.includes(\"Already validated\")) {\n            errorMsg = \"é”™è¯¯ï¼šè¯¥è¯æ˜Žå·²è¢«éªŒè¯\";\n          } else if (errorMsg.includes(\"Invalid status\")) {\n            errorMsg = \"é”™è¯¯ï¼šæ— æ•ˆçš„éªŒè¯çŠ¶æ€\";\n          }\n        }\n        \n        setMessage(`âŒ éªŒè¯å¤±è´¥: ${errorMsg}`);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [instance, contractWithSigner, contractAddress, ethersSigner]\n  );\n\n  // è§£å¯†åˆ†æ•°\n  const decryptScore = useCallback(\n    async (handle: string) => {\n      if (!instance || !ethersSigner || !contractAddress) {\n        setMessage(\"FHEVMå®žä¾‹æœªå°±ç»ª\");\n        return null;\n      }\n\n      setIsLoading(true);\n      setMessage(\"ðŸ”“ æ­£åœ¨è§£å¯†åˆ†æ•°...\");\n\n      try {\n        const sig = await FhevmDecryptionSignature.loadOrSign(\n          instance,\n          [contractAddress],\n          ethersSigner,\n          fhevmDecryptionSignatureStorage\n        );\n\n        if (!sig) {\n          setMessage(\"æ— æ³•æž„å»ºè§£å¯†ç­¾å\");\n          return null;\n        }\n\n        const res = await instance.userDecrypt(\n          [{ handle, contractAddress }],\n          sig.privateKey,\n          sig.publicKey,\n          sig.signature,\n          sig.contractAddresses,\n          sig.userAddress,\n          sig.startTimestamp,\n          sig.durationDays\n        );\n\n        setMessage(\"âœ… è§£å¯†å®Œæˆï¼\");\n        return res[handle];\n      } catch (error: any) {\n        setMessage(`âŒ è§£å¯†é”™è¯¯: ${error.message}`);\n        return null;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [instance, ethersSigner, contractAddress, fhevmDecryptionSignatureStorage]\n  );\n\n  // æŽˆæƒéªŒè¯è€…\n  const grantValidator = useCallback(\n    async (validatorAddress: string) => {\n      if (!contractWithSigner) {\n        setMessage(\"åˆçº¦æœªå°±ç»ª\");\n        return false;\n      }\n\n      setIsLoading(true);\n      setMessage(\"âš¡ æ­£åœ¨æŽˆæƒéªŒè¯è€…...\");\n\n      try {\n        const tx = await contractWithSigner.grantValidatorRole(\n          validatorAddress,\n          true,\n          { gasLimit: 100000 }\n        );\n\n        setMessage(`â³ äº¤æ˜“å·²å‘é€: ${tx.hash}`);\n        const receipt = await tx.wait();\n        setMessage(`âœ… éªŒè¯è€…æŽˆæƒæˆåŠŸï¼çŠ¶æ€: ${receipt?.status}`);\n        return true;\n      } catch (error: any) {\n        console.error(\"GrantValidator error:\", error);\n        const errorMsg = error?.reason || error?.message || \"æœªçŸ¥é”™è¯¯\";\n        setMessage(`âŒ é”™è¯¯: ${errorMsg}`);\n        return false;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [contractWithSigner]\n  );\n\n  // æ£€æŸ¥éªŒè¯è€…æŽˆæƒçŠ¶æ€\n  const checkValidatorAuth = useCallback(\n    async (validatorAddress: string): Promise<boolean> => {\n      if (!contract) return false;\n\n      try {\n        const isAuthorized = await contract.authorizedValidators(validatorAddress);\n        return isAuthorized;\n      } catch (error) {\n        console.error(\"CheckValidatorAuth error:\", error);\n        return false;\n      }\n    },\n    [contract]\n  );\n\n  // é¢†å–å¾½ç« \n  const claimBadge = useCallback(\n    async (courseId: number, badgeCID: string, totalScore: number) => {\n      if (!instance || !contractWithSigner || !ethersSigner) {\n        setMessage(\"FHEVMå®žä¾‹æˆ–åˆçº¦æœªå°±ç»ª\");\n        return;\n      }\n\n      setIsLoading(true);\n      setMessage(\"âš¡ åŠ å¯†æ€»åˆ†...\");\n\n      try {\n        const input = instance.createEncryptedInput(\n          contractAddress!,\n          await ethersSigner.getAddress()\n        );\n        input.add64(BigInt(totalScore));\n\n        const enc = await input.encrypt();\n\n        setMessage(\"ðŸ… æäº¤é¢†å–äº¤æ˜“...\");\n        \n        const handle = convertHandleToBytes32(enc.handles[0]);\n\n        const tx = await contractWithSigner.claimBadge(\n          courseId,\n          badgeCID,\n          handle,\n          enc.inputProof,\n          { gasLimit: 5000000 }\n        );\n\n        setMessage(`â³ äº¤æ˜“å·²å‘é€: ${tx.hash}`);\n        const receipt = await tx.wait();\n        setMessage(`âœ… å¾½ç« é¢†å–æˆåŠŸï¼çŠ¶æ€: ${receipt?.status === 1 ? 'æˆåŠŸ' : 'å¤±è´¥'}`);\n        \n        setTimeout(() => {\n          window.location.href = \"/badges\";\n        }, 2000);\n      } catch (error: any) {\n        console.error(\"ClaimBadge error:\", error);\n        const errorMsg = error?.reason || error?.message || \"æœªçŸ¥é”™è¯¯\";\n        setMessage(`âŒ é¢†å–å¤±è´¥: ${errorMsg}`);\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [instance, contractWithSigner, contractAddress, ethersSigner]\n  );\n\n  return {\n    contract,\n    contractWithSigner,\n    forgeCourse,\n    submitProof,\n    validateProof,\n    claimBadge,\n    decryptScore,\n    grantValidator,\n    checkValidatorAuth,\n    message,\n    isLoading,\n  };\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1553, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/hooks/useProofs.tsx"],"sourcesContent":["\"use client\";\n\nimport { ethers } from \"ethers\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\n\nconst SKILLFORGE_ABI = [\n  \"function getProof(uint256 proofId) view returns (uint256 courseId, uint256 challengeId, address learner, string proofCID, uint8 status, address validator, uint256 submittedAt)\",\n  \"function getProofEncryptedScore(uint256 proofId) view returns (bytes32 encryptedScoreHandle)\",\n  \"function nextProofId() view returns (uint256)\",\n  \"event ProofSubmitted(uint256 indexed proofId, uint256 indexed courseId, address indexed learner, string proofCID)\",\n  \"event ProofValidated(uint256 indexed proofId, address indexed validator, uint8 status)\",\n] as const;\n\nexport type ProofStatus = 0 | 1 | 2; // Pending, Approved, Rejected\n\nexport type Proof = {\n  id: number;\n  courseId: number;\n  challengeId: number;\n  learner: string;\n  proofCID: string;\n  status: ProofStatus;\n  validator: string;\n  submittedAt: number;\n  decryptedScore?: bigint; // è§£å¯†åŽçš„åˆ†æ•°ï¼ˆå¯é€‰ï¼‰\n};\n\nexport function useProofs(parameters: {\n  contractAddress: `0x${string}` | undefined;\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\n  instance: FhevmInstance | undefined;\n  ethersSigner: ethers.JsonRpcSigner | undefined;\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\n  chainId: number | undefined;\n}) {\n  const {\n    contractAddress,\n    ethersReadonlyProvider,\n    instance,\n    ethersSigner,\n    fhevmDecryptionSignatureStorage,\n    chainId,\n  } = parameters;\n\n  const [proofs, setProofs] = useState<Proof[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const contract = useMemo(() => {\n    if (!contractAddress || !ethersReadonlyProvider) return undefined;\n    return new ethers.Contract(contractAddress, SKILLFORGE_ABI, ethersReadonlyProvider);\n  }, [contractAddress, ethersReadonlyProvider]);\n\n  // èŽ·å–æ‰€æœ‰å¾…å®¡æ ¸çš„æäº¤\n  const fetchPendingProofs = useCallback(async () => {\n    if (!contract) {\n      setProofs([]);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // é€šè¿‡äº‹ä»¶èŽ·å–æ‰€æœ‰ProofCreatedäº‹ä»¶ï¼ˆæ›´é«˜æ•ˆï¼‰\n      const allProofs: Proof[] = [];\n      \n      try {\n        // æŸ¥è¯¢æ‰€æœ‰ProofSubmittedäº‹ä»¶\n        const filter = contract.filters.ProofSubmitted();\n        const events = await contract.queryFilter(filter);\n        \n        // ä»Žäº‹ä»¶ä¸­æå–proof IDs\n        const proofIds = new Set<number>();\n        events.forEach((event) => {\n          if (event.args && event.args.proofId) {\n            proofIds.add(Number(event.args.proofId));\n          }\n        });\n\n        // å¹¶è¡ŒèŽ·å–æ¯ä¸ªproofçš„è¯¦æƒ…\n        const proofPromises = Array.from(proofIds).map(async (id) => {\n          try {\n            const [\n              courseId,\n              challengeId,\n              learner,\n              proofCID,\n              status,\n              validator,\n              submittedAt,\n            ] = await contract.getProof(id);\n\n            // åªè¿”å›žå¾…å®¡æ ¸çš„ï¼ˆstatus === 0ï¼‰\n            if (Number(status) === 0) {\n              return {\n                id,\n                courseId: Number(courseId),\n                challengeId: Number(challengeId),\n                learner,\n                proofCID,\n                status: Number(status) as ProofStatus,\n                validator,\n                submittedAt: Number(submittedAt),\n              } as Proof;\n            }\n            return null;\n          } catch (e) {\n            console.log(`Error fetching proof ${id}:`, e);\n            return null;\n          }\n        });\n\n        const results = await Promise.all(proofPromises);\n        results.forEach((sub) => {\n          if (sub) {\n            allProofs.push(sub);\n          }\n        });\n      } catch (e) {\n        console.error(\"Error querying events:\", e);\n        // Fallback: å¦‚æžœäº‹ä»¶æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨nextProofId\n        try {\n          const nextId = await contract.nextProofId();\n          const totalProofs = Number(nextId);\n          \n          for (let i = 1; i < totalProofs; i++) {\n            try {\n              const [\n                courseId,\n                challengeId,\n                learner,\n                proofCID,\n                status,\n                validator,\n                submittedAt,\n              ] = await contract.getProof(i);\n\n              if (Number(status) === 0) {\n                allProofs.push({\n                  id: i,\n                  courseId: Number(courseId),\n                  challengeId: Number(challengeId),\n                  learner,\n                  proofCID,\n                  status: Number(status) as ProofStatus,\n                  validator,\n                  submittedAt: Number(submittedAt),\n                });\n              }\n            } catch (e) {\n              // è·³è¿‡ä¸å­˜åœ¨çš„proof\n            }\n          }\n        } catch (fallbackError) {\n          console.error(\"Fallback method also failed:\", fallbackError);\n        }\n      }\n\n      // æŒ‰æäº¤æ—¶é—´å€’åºæŽ’åˆ—\n      allProofs.sort((a, b) => b.submittedAt - a.submittedAt);\n\n      setProofs(allProofs);\n    } catch (e: any) {\n      console.error(\"Error fetching proofs:\", e);\n      setError(e.message || \"Failed to fetch proofs\");\n    } finally {\n      setIsLoading(false);\n    }\n  }, [contract]);\n\n  // èŽ·å–å•ä¸ªæäº¤è¯¦æƒ…\n  const fetchProof = useCallback(\n    async (proofId: number): Promise<Proof | null> => {\n      if (!contract) return null;\n\n      try {\n        const [\n          courseId,\n          challengeId,\n          learner,\n          proofCID,\n          status,\n          validator,\n          submittedAt,\n        ] = await contract.getProof(proofId);\n\n        return {\n          id: proofId,\n          courseId: Number(courseId),\n          challengeId: Number(challengeId),\n          learner,\n          proofCID,\n          status: Number(status) as ProofStatus,\n          validator,\n          submittedAt: Number(submittedAt),\n        };\n      } catch (e: any) {\n        console.error(`Error fetching proof ${proofId}:`, e);\n        return null;\n      }\n    },\n    [contract]\n  );\n\n  // è§£å¯†åˆ†æ•°ï¼ˆå¦‚æžœéœ€è¦æ˜¾ç¤ºï¼‰\n  const decryptScore = useCallback(\n    async (handle: string): Promise<bigint | null> => {\n      if (!instance || !ethersSigner || !contractAddress) {\n        return null;\n      }\n\n      try {\n        const sig = await FhevmDecryptionSignature.loadOrSign(\n          instance,\n          [contractAddress],\n          ethersSigner,\n          fhevmDecryptionSignatureStorage\n        );\n\n        if (!sig) {\n          return null;\n        }\n\n        const res = await instance.userDecrypt(\n          [{ handle, contractAddress }],\n          sig.privateKey,\n          sig.publicKey,\n          sig.signature,\n          sig.contractAddresses,\n          sig.userAddress,\n          sig.startTimestamp,\n          sig.durationDays\n        );\n\n        return res[handle] || null;\n      } catch (e) {\n        console.error(\"Error decrypting score:\", e);\n        return null;\n      }\n    },\n    [instance, ethersSigner, contractAddress, fhevmDecryptionSignatureStorage]\n  );\n\n  // ç›‘å¬äº‹ä»¶\n  useEffect(() => {\n    if (!contract || !ethersReadonlyProvider) return;\n\n    const filterCreated = contract.filters.ProofSubmitted();\n    const filterVerified = contract.filters.ProofValidated();\n\n    const handleCreated = () => {\n      console.log(\"New proof submitted, refreshing...\");\n      fetchPendingProofs();\n    };\n\n    const handleVerified = () => {\n      console.log(\"Proof validated, refreshing...\");\n      fetchPendingProofs();\n    };\n\n    // ç›‘å¬äº‹ä»¶\n    contract.on(filterCreated, handleCreated);\n    contract.on(filterVerified, handleVerified);\n\n    // åˆå§‹åŠ è½½\n    fetchPendingProofs();\n\n    return () => {\n      contract.off(filterCreated, handleCreated);\n      contract.off(filterVerified, handleVerified);\n    };\n  }, [contract, ethersReadonlyProvider, fetchPendingProofs]);\n\n  // èŽ·å–æ‰€æœ‰å·²å®¡æ ¸çš„æäº¤\n  const fetchReviewedProofs = useCallback(async () => {\n    if (!contract) {\n      setProofs([]);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const allProofs: Proof[] = [];\n      \n      try {\n        // æŸ¥è¯¢æ‰€æœ‰ProofValidatedäº‹ä»¶\n        const filter = contract.filters.ProofValidated();\n        const events = await contract.queryFilter(filter);\n        \n        // ä»Žäº‹ä»¶ä¸­æå–proof IDs\n        const proofIds = new Set<number>();\n        events.forEach((event) => {\n          if (event.args && event.args.proofId) {\n            proofIds.add(Number(event.args.proofId));\n          }\n        });\n\n        // å¹¶è¡ŒèŽ·å–æ¯ä¸ªproofçš„è¯¦æƒ…\n        const proofPromises = Array.from(proofIds).map(async (id) => {\n          try {\n            const [\n              courseId,\n              challengeId,\n              learner,\n              proofCID,\n              status,\n              validator,\n              submittedAt,\n            ] = await contract.getProof(id);\n\n            // åªè¿”å›žå·²å®¡æ ¸çš„ï¼ˆstatus === 1 æˆ– 2ï¼‰\n            const statusNum = Number(status);\n            if (statusNum === 1 || statusNum === 2) {\n              return {\n                id,\n                courseId: Number(courseId),\n                challengeId: Number(challengeId),\n                learner,\n                proofCID,\n                status: statusNum as ProofStatus,\n                validator,\n                submittedAt: Number(submittedAt),\n              } as Proof;\n            }\n            return null;\n          } catch (e) {\n            console.log(`Error fetching proof ${id}:`, e);\n            return null;\n          }\n        });\n\n        const results = await Promise.all(proofPromises);\n        results.forEach((sub) => {\n          if (sub) {\n            allProofs.push(sub);\n          }\n        });\n      } catch (e) {\n        console.error(\"Error querying events:\", e);\n        // Fallback: å¦‚æžœäº‹ä»¶æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨nextProofId\n        try {\n          const nextId = await contract.nextProofId();\n          const totalProofs = Number(nextId);\n          \n          for (let i = 1; i < totalProofs; i++) {\n            try {\n              const [\n                courseId,\n                challengeId,\n                learner,\n                proofCID,\n                status,\n                validator,\n                submittedAt,\n              ] = await contract.getProof(i);\n\n              const statusNum = Number(status);\n              if (statusNum === 1 || statusNum === 2) {\n                allProofs.push({\n                  id: i,\n                  courseId: Number(courseId),\n                  challengeId: Number(challengeId),\n                  learner,\n                  proofCID,\n                  status: statusNum as ProofStatus,\n                  validator,\n                  submittedAt: Number(submittedAt),\n                });\n              }\n            } catch (e) {\n              // è·³è¿‡ä¸å­˜åœ¨çš„proof\n            }\n          }\n        } catch (fallbackError) {\n          console.error(\"Fallback method also failed:\", fallbackError);\n        }\n      }\n\n      // æŒ‰å®¡æ ¸æ—¶é—´å€’åºæŽ’åˆ—ï¼ˆé€šè¿‡verifiedAtäº‹ä»¶æ—¶é—´æˆ³ï¼‰\n      allProofs.sort((a, b) => b.submittedAt - a.submittedAt);\n\n      setProofs(allProofs);\n    } catch (e: any) {\n      console.error(\"Error fetching reviewed proofs:\", e);\n      setError(e.message || \"Failed to fetch reviewed proofs\");\n    } finally {\n      setIsLoading(false);\n    }\n  }, [contract]);\n\n  // è§£å¯†æäº¤åˆ†æ•°ï¼ˆé€šè¿‡proofIdï¼‰\n  const decryptProofScore = useCallback(\n    async (proofId: number): Promise<bigint | null> => {\n      if (!instance || !ethersSigner || !contractAddress || !contract) {\n        return null;\n      }\n\n      try {\n        // èŽ·å–æäº¤çš„åŠ å¯†åˆ†æ•°handle\n        const encryptedScoreHandle = await contract.getProofEncryptedScore(proofId);\n        \n        // å°†handleè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼\n        const handle = typeof encryptedScoreHandle === 'string' \n          ? encryptedScoreHandle \n          : ethers.hexlify(encryptedScoreHandle);\n\n        // æž„å»ºè§£å¯†ç­¾å\n        const sig = await FhevmDecryptionSignature.loadOrSign(\n          instance,\n          [contractAddress],\n          ethersSigner,\n          fhevmDecryptionSignatureStorage\n        );\n\n        if (!sig) {\n          return null;\n        }\n\n        // è§£å¯†\n        const res = await instance.userDecrypt(\n          [{ handle, contractAddress }],\n          sig.privateKey,\n          sig.publicKey,\n          sig.signature,\n          sig.contractAddresses,\n          sig.userAddress,\n          sig.startTimestamp,\n          sig.durationDays\n        );\n\n        return res[handle] || null;\n      } catch (e) {\n        console.error(\"Error decrypting proof score:\", e);\n        return null;\n      }\n    },\n    [instance, ethersSigner, contractAddress, fhevmDecryptionSignatureStorage, contract]\n  );\n\n  // ä¸ºæäº¤è§£å¯†åˆ†æ•°å¹¶æ›´æ–°çŠ¶æ€\n  const decryptAndUpdateProof = useCallback(\n    async (proofId: number) => {\n      const score = await decryptProofScore(proofId);\n      if (score !== null) {\n        setProofs((prev) =>\n          prev.map((sub) =>\n            sub.id === proofId ? { ...sub, decryptedScore: score } : sub\n          )\n        );\n      }\n      return score;\n    },\n    [decryptProofScore]\n  );\n\n  return {\n    proofs,\n    isLoading,\n    error,\n    fetchPendingProofs,\n    fetchReviewedProofs,\n    fetchProof,\n    decryptScore,\n    decryptProofScore,\n    decryptAndUpdateProof,\n  };\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1959, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/app/validate/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport WalletGuard from \"@/components/WalletGuard\";\nimport { useFhevm } from \"@/fhevm/useFhevm\";\nimport { useMetaMaskEthersSigner } from \"@/hooks/metamask/useMetaMaskEthersSigner\";\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\nimport { useSkillForge } from \"@/hooks/useSkillForge\";\nimport { useProofs } from \"@/hooks/useProofs\";\n\nconst CONTRACT_ADDRESS = \"0x5FbDB2315678afecb367f032d93F642f64180aa3\" as `0x${string}`;\n\nexport default function ValidatePage() {\n  const { storage } = useInMemoryStorage();\n  const { provider, chainId, ethersSigner, ethersReadonlyProvider, initialMockChains, isConnected } = useMetaMaskEthersSigner();\n  const { instance: fhevmInstance } = useFhevm({ provider, chainId, initialMockChains, enabled: isConnected });\n  const { validateProof, message, isLoading } = useSkillForge({ instance: fhevmInstance, fhevmDecryptionSignatureStorage: storage, contractAddress: CONTRACT_ADDRESS, ethersSigner, ethersReadonlyProvider, chainId });\n  const { proofs, isLoading: proofsLoading } = useProofs({ contractAddress: CONTRACT_ADDRESS, ethersReadonlyProvider, instance: fhevmInstance, ethersSigner, fhevmDecryptionSignatureStorage: storage, chainId });\n\n  const [selectedProof, setSelectedProof] = useState<number>(0);\n  const [newScore, setNewScore] = useState<number>(85);\n  const [validationStatus, setValidationStatus] = useState<number>(1);\n\n  const handleValidate = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (selectedProof > 0) {\n      await validateProof(selectedProof, validationStatus, newScore);\n    }\n  };\n\n  return (\n    <WalletGuard>\n      <div className=\"min-h-[calc(100vh-5rem)] py-12\">\n        <div className=\"container mx-auto px-4 max-w-6xl\">\n          <div className=\"mb-10 text-center\">\n            <div className=\"inline-flex items-center space-x-3 mb-4\">\n              <div className=\"h-1 w-8 bg-gradient-purple rounded-full\"></div>\n              <span className=\"text-5xl animate-float\">âœ“</span>\n              <div className=\"h-1 w-8 bg-gradient-purple rounded-full\"></div>\n            </div>\n            <h1 className=\"text-5xl font-display font-black mb-3\">\n              <span className=\"gradient-text\">Validate Proofs</span>\n            </h1>\n            <p className=\"text-white/80 text-lg\">Review and assess skill proofs</p>\n          </div>\n\n          <div className=\"grid lg:grid-cols-2 gap-6\">\n            {/* Left: Pending List */}\n            <div className=\"glass-strong rounded-3xl p-6 shadow-glass\">\n              <h2 className=\"text-2xl font-display font-bold text-white mb-6\">Pending Validation</h2>\n              {proofsLoading ? (\n                <div className=\"text-center py-8\">\n                  <div className=\"inline-block h-8 w-8 border-4 border-white/20 border-t-primary rounded-full animate-spin\"></div>\n                  <p className=\"text-white/70 mt-2\">Loading...</p>\n                </div>\n              ) : proofs.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <div className=\"text-5xl mb-4 animate-float\">ðŸ“‹</div>\n                  <p className=\"text-white/60\">No pending proofs</p>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {proofs.map((proof, index) => (\n                    <div \n                      key={proof.id} \n                      onClick={() => setSelectedProof(proof.id)} \n                      className={`p-4 rounded-2xl cursor-pointer transition-all ${\n                        selectedProof === proof.id \n                          ? 'glass-strong shadow-glow border-2 border-primary' \n                          : 'glass hover:glass-strong'\n                      }`}\n                      style={{animationDelay: `${index * 0.1}s`}}\n                    >\n                      <div className=\"flex justify-between items-start\">\n                        <div>\n                          <p className=\"text-white font-bold text-lg\">Proof #{proof.id}</p>\n                          <p className=\"text-sm text-white/60 mt-1\">\n                            Course #{proof.courseId} Â· Challenge #{proof.challengeId}\n                          </p>\n                        </div>\n                        <span className=\"px-3 py-1 bg-gradient-purple rounded-full text-xs font-bold text-white shadow-glow\">\n                          Pending\n                        </span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* Right: Validation Form */}\n            <div className=\"glass-strong rounded-3xl shadow-glass-lg overflow-hidden\">\n              <div className=\"bg-gradient-purple p-8\">\n                <h2 className=\"text-3xl font-display font-black text-white\">Validation Action</h2>\n              </div>\n\n              <form onSubmit={handleValidate} className=\"p-6 space-y-6\">\n                <div>\n                  <label className=\"block text-sm font-bold text-white mb-2\">Proof ID</label>\n                  <input \n                    type=\"number\" \n                    value={selectedProof} \n                    onChange={(e) => setSelectedProof(parseInt(e.target.value))} \n                    className=\"w-full px-4 py-3 glass rounded-2xl text-white focus:outline-none transition-all\" \n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-bold text-white mb-2\">Validation Status</label>\n                  <select \n                    value={validationStatus} \n                    onChange={(e) => setValidationStatus(parseInt(e.target.value))} \n                    className=\"w-full px-4 py-3 glass rounded-2xl text-white focus:outline-none transition-all\"\n                  >\n                    <option value={1}>âœ“ Approved</option>\n                    <option value={2}>âœ— Rejected</option>\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-bold text-white mb-2\">Score (0-100)</label>\n                  <input \n                    type=\"number\" \n                    min=\"0\" \n                    max=\"100\" \n                    value={newScore} \n                    onChange={(e) => setNewScore(parseInt(e.target.value))} \n                    className=\"w-full px-4 py-3 glass rounded-2xl text-white focus:outline-none transition-all\" \n                  />\n                  <p className=\"text-xs text-white/50 mt-2\">ðŸ”’ Will be encrypted</p>\n                </div>\n\n                <button \n                  type=\"submit\" \n                  disabled={isLoading || selectedProof === 0} \n                  className=\"w-full py-4 bg-gradient-purple rounded-2xl font-bold text-white shadow-glow hover:shadow-glow-cyan transition-all btn-glass disabled:opacity-50\"\n                >\n                  <span className=\"flex items-center justify-center space-x-2\">\n                    {isLoading ? (\n                      <>\n                        <div className=\"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                        <span>Validating...</span>\n                      </>\n                    ) : (\n                      <>\n                        <span>âœ“</span>\n                        <span>Submit Validation</span>\n                      </>\n                    )}\n                  </span>\n                </button>\n\n                {message && (\n                  <div className=\"glass-dark rounded-2xl p-4 border border-white/10\">\n                    <p className=\"text-sm text-white/90 break-all\">{message}</p>\n                  </div>\n                )}\n              </form>\n            </div>\n          </div>\n        </div>\n      </div>\n    </WalletGuard>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}