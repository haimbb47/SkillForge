{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\n\n\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\nimport { SDK_CDN_URL } from \"./constants\";\n\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\n\nexport class RelayerSDKLoader {\n  private _trace?: TraceType;\n\n  constructor(options: { trace?: TraceType }) {\n    this._trace = options.trace;\n  }\n\n  public isLoaded() {\n    if (typeof window === \"undefined\") {\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\n    }\n    return isFhevmWindowType(window, this._trace);\n  }\n\n  public load(): Promise<void> {\n    console.log(\"[RelayerSDKLoader] load...\");\n    if (typeof window === \"undefined\") {\n      console.log(\"[RelayerSDKLoader] window === undefined\");\n      return Promise.reject(\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\n      );\n    }\n\n    if (\"relayerSDK\" in window) {\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\n      }\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve, reject) => {\n      const existingScript = document.querySelector(\n        `script[src=\"${SDK_CDN_URL}\"]`\n      );\n      if (existingScript) {\n        if (!isFhevmWindowType(window, this._trace)) {\n          reject(\n            new Error(\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\n            )\n          );\n        }\n        resolve();\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src = SDK_CDN_URL;\n      script.type = \"text/javascript\";\n      script.async = true;\n\n      script.onload = () => {\n        if (!isFhevmWindowType(window, this._trace)) {\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\n          reject(\n            new Error(\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\n            )\n          );\n        }\n        resolve();\n      };\n\n      script.onerror = () => {\n        console.log(\"[RelayerSDKLoader] script onerror... \");\n        reject(\n          new Error(\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\n          )\n        );\n      };\n\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\n      document.head.appendChild(script);\n      console.log(\"[RelayerSDKLoader] script added!\")\n    });\n  }\n}\n\nfunction isFhevmRelayerSDKType(\n  o: unknown,\n  trace?: TraceType\n): o is FhevmRelayerSDKType {\n  if (typeof o === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\n    return false;\n  }\n  if (o === null) {\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\n    return false;\n  }\n  if (typeof o !== \"object\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\n    return false;\n  }\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\n    return false;\n  }\n  if (\"__initialized__\" in o) {\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isFhevmWindowType(\n  win: unknown,\n  trace?: TraceType\n): win is FhevmWindowType {\n  if (typeof win === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\n    return false;\n  }\n  if (win === null) {\n    trace?.(\"RelayerSDKLoader: window object is null\");\n    return false;\n  }\n  if (typeof win !== \"object\") {\n    trace?.(\"RelayerSDKLoader: window is not an object\");\n    return false;\n  }\n  if (!(\"relayerSDK\" in win)) {\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\n    return false;\n  }\n  return isFhevmRelayerSDKType(win.relayerSDK);\n}\n\nfunction objHasProperty<\n  T extends object,\n  K extends PropertyKey,\n  V extends string\n>(\n  obj: T,\n  propertyName: K,\n  propertyType: V,\n  trace?: TraceType\n): obj is T &\n  Record<\n    K,\n    V extends \"string\"\n      ? string\n      : V extends \"number\"\n      ? number\n      : V extends \"object\"\n      ? object\n      : V extends \"boolean\"\n      ? boolean\n      : V extends \"function\"\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (...args: any[]) => any\n      : unknown\n  > {\n  if (!obj || typeof obj !== \"object\") {\n    return false;\n  }\n\n  if (!(propertyName in obj)) {\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\n    return false;\n  }\n\n  const value = (obj as Record<K, unknown>)[propertyName];\n\n  if (value === null || value === undefined) {\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\n    return false;\n  }\n\n  if (typeof value !== propertyType) {\n    trace?.(\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\n    );\n    return false;\n  }\n\n  return true;\n}\n\n\n"],"names":[],"mappings":";;;;;;AACA;;AAIO,MAAM;IACH,OAAmB;IAE3B,YAAY,OAA8B,CAAE;QAC1C,IAAI,CAAC,MAAM,GAAG,QAAQ,KAAK;IAC7B;IAEO,WAAW;QAChB,wCAAmC;YACjC,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,kBAAkB,QAAQ,IAAI,CAAC,MAAM;IAC9C;IAEO,OAAsB;QAC3B,QAAQ,GAAG,CAAC;QACZ,wCAAmC;YACjC,QAAQ,GAAG,CAAC;YACZ,OAAO,QAAQ,MAAM,CACnB,IAAI,MAAM;QAEd;;;IAwDF;AACF;AAEA,SAAS,sBACP,CAAU,EACV,KAAiB;IAEjB,IAAI,OAAO,MAAM,aAAa;QAC5B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,MAAM,MAAM;QACd,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,MAAM,UAAU;QACzB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,WAAW,YAAY,QAAQ;QACpD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,kBAAkB,YAAY,QAAQ;QAC3D,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,iBAAiB,UAAU,QAAQ;QACxD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,qBAAqB,GAAG;QAC1B,IAAI,EAAE,eAAe,KAAK,QAAQ,EAAE,eAAe,KAAK,OAAO;YAC7D,QAAQ;YACR,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,kBACd,GAAY,EACZ,KAAiB;IAEjB,IAAI,OAAO,QAAQ,aAAa;QAC9B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,QAAQ,MAAM;QAChB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,QAAQ,UAAU;QAC3B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ;QACR,OAAO;IACT;IACA,OAAO,sBAAsB,IAAI,UAAU;AAC7C;AAEA,SAAS,eAKP,GAAM,EACN,YAAe,EACf,YAAe,EACf,KAAiB;IAiBjB,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;QACnC,OAAO;IACT;IAEA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ,CAAC,0BAA0B,EAAE,OAAO,cAAc,CAAC,CAAC;QAC5D,OAAO;IACT;IAEA,MAAM,QAAQ,AAAC,GAA0B,CAAC,aAAa;IAEvD,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,QAAQ,CAAC,kBAAkB,EAAE,OAAO,cAAc,sBAAsB,CAAC;QACzE,OAAO;IACT;IAEA,IAAI,OAAO,UAAU,cAAc;QACjC,QACE,CAAC,kBAAkB,EAAE,OAAO,cAAc,UAAU,EAAE,aAAa,CAAC,CAAC;QAEvE,OAAO;IACT;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\n\ntype FhevmStoredPublicKey = {\n  publicKeyId: string;\n  publicKey: Uint8Array;\n};\n\ntype FhevmStoredPublicParams = {\n  publicParamsId: string;\n  publicParams: Uint8Array;\n};\n\ninterface PublicParamsDB extends DBSchema {\n  publicKeyStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicKey;\n    };\n  };\n  paramsStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicParams;\n    };\n  };\n}\n\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\n\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\n  if (__dbPromise) {\n    return __dbPromise;\n  }\n  if (typeof window === \"undefined\") {\n    return undefined;\n  }\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\n    upgrade(db) {\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\n      }\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\n      }\n    },\n  });\n  return __dbPromise;\n}\n\ntype FhevmInstanceConfigPublicKey = {\n  data: Uint8Array | null;\n  id: string | null;\n};\n\ntype FhevmInstanceConfigPublicParams = {\n  \"2048\": {\n    publicParamsId: string;\n    publicParams: Uint8Array;\n  };\n};\n\nfunction assertFhevmStoredPublicKey(\n  value: unknown\n): asserts value is FhevmStoredPublicKey | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicKey must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicKeyId\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\n  }\n  if (typeof value.publicKeyId !== \"string\") {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\n  }\n  if (!(\"publicKey\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\n  }\n  if (!(value.publicKey instanceof Uint8Array)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\n  }\n}\n\nfunction assertFhevmStoredPublicParams(\n  value: unknown\n): asserts value is FhevmStoredPublicParams | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicParams must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicParamsId\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\n  }\n  if (typeof value.publicParamsId !== \"string\") {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\n  }\n  if (!(\"publicParams\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\n  }\n  if (!(value.publicParams instanceof Uint8Array)) {\n    throw new Error(\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\n    );\n  }\n}\n\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\n  publicKey?: FhevmInstanceConfigPublicKey;\n  publicParams: FhevmInstanceConfigPublicParams | null;\n}> {\n  const db = await _getDB();\n  if (!db) {\n    return { publicParams: null };\n  }\n\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\n  try {\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\n    if (pk?.value) {\n      assertFhevmStoredPublicKey(pk.value);\n      storedPublicKey = pk.value;\n    }\n  } catch {\n    //\n  }\n\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\n  try {\n    const pp = await db.get(\"paramsStore\", aclAddress);\n    if (pp?.value) {\n      assertFhevmStoredPublicParams(pp.value);\n      storedPublicParams = pp.value;\n    }\n  } catch {\n    //\n  }\n\n  const publicKeyData = storedPublicKey?.publicKey;\n  const publicKeyId = storedPublicKey?.publicKeyId;\n  const publicParams = storedPublicParams\n    ? {\n        \"2048\": storedPublicParams,\n      }\n    : null;\n\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\n\n  if (publicKeyId && publicKeyData) {\n    publicKey = {\n      id: publicKeyId,\n      data: publicKeyData,\n    };\n  }\n\n  return {\n    ...(publicKey !== undefined && { publicKey }),\n    publicParams,\n  };\n}\n\nexport async function publicKeyStorageSet(\n  aclAddress: `0x${string}`,\n  publicKey: FhevmStoredPublicKey | null,\n  publicParams: FhevmStoredPublicParams | null\n) {\n  assertFhevmStoredPublicKey(publicKey);\n  assertFhevmStoredPublicParams(publicParams);\n\n  const db = await _getDB();\n  if (!db) {\n    return;\n  }\n\n  if (publicKey) {\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\n  }\n\n  if (publicParams) {\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;;AAAA;;AA6BA,IAAI,cAAiE;AAErE,eAAe;IACb,IAAI,aAAa;QACf,OAAO;IACT;IACA,wCAAmC;QACjC,OAAO;IACT;;;AAYF;AAcA,SAAS,2BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,sCAAsC,CAAC;IAC1D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,iBAAiB,KAAK,GAAG;QAC7B,MAAM,IAAI,MAAM,CAAC,+CAA+C,CAAC;IACnE;IACA,IAAI,OAAO,MAAM,WAAW,KAAK,UAAU;QACzC,MAAM,IAAI,MAAM,CAAC,iDAAiD,CAAC;IACrE;IACA,IAAI,CAAC,CAAC,eAAe,KAAK,GAAG;QAC3B,MAAM,IAAI,MAAM,CAAC,6CAA6C,CAAC;IACjE;IACA,IAAI,CAAC,CAAC,MAAM,SAAS,YAAY,UAAU,GAAG;QAC5C,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;AACF;AAEA,SAAS,8BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,yCAAyC,CAAC;IAC7D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,GAAG;QAChC,MAAM,IAAI,MAAM,CAAC,qDAAqD,CAAC;IACzE;IACA,IAAI,OAAO,MAAM,cAAc,KAAK,UAAU;QAC5C,MAAM,IAAI,MAAM,CAAC,uDAAuD,CAAC;IAC3E;IACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;IACA,IAAI,CAAC,CAAC,MAAM,YAAY,YAAY,UAAU,GAAG;QAC/C,MAAM,IAAI,MACR,CAAC,yDAAyD,CAAC;IAE/D;AACF;AAEO,eAAe,oBAAoB,UAAyB;IAIjE,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP,OAAO;YAAE,cAAc;QAAK;IAC9B;IAEA,IAAI,kBAA+C;IACnD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,kBAAkB;QAC1C,IAAI,IAAI,OAAO;YACb,2BAA2B,GAAG,KAAK;YACnC,kBAAkB,GAAG,KAAK;QAC5B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,IAAI,qBAAqD;IACzD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,eAAe;QACvC,IAAI,IAAI,OAAO;YACb,8BAA8B,GAAG,KAAK;YACtC,qBAAqB,GAAG,KAAK;QAC/B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,MAAM,gBAAgB,iBAAiB;IACvC,MAAM,cAAc,iBAAiB;IACrC,MAAM,eAAe,qBACjB;QACE,QAAQ;IACV,IACA;IAEJ,IAAI,YAAsD;IAE1D,IAAI,eAAe,eAAe;QAChC,YAAY;YACV,IAAI;YACJ,MAAM;QACR;IACF;IAEA,OAAO;QACL,GAAI,cAAc,aAAa;YAAE;QAAU,CAAC;QAC5C;IACF;AACF;AAEO,eAAe,oBACpB,UAAyB,EACzB,SAAsC,EACtC,YAA4C;IAE5C,2BAA2B;IAC3B,8BAA8B;IAE9B,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP;IACF;IAEA,IAAI,WAAW;QACb,MAAM,GAAG,GAAG,CAAC,kBAAkB;YAAE,KAAK;YAAY,OAAO;QAAU;IACrE;IAEA,IAAI,cAAc;QAChB,MAAM,GAAG,GAAG,CAAC,eAAe;YAAE,KAAK;YAAY,OAAO;QAAa;IACrE;AACF","debugId":null}},
    {"offset": {"line": 246, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\nimport type {\n  FhevmInitSDKOptions,\n  FhevmInitSDKType,\n  FhevmLoadSDKType,\n  FhevmWindowType,\n} from \"./fhevmTypes\";\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\nimport { FhevmInstance, FhevmInstanceConfig } from \"../../fhevmTypes\";\n\nexport class FhevmReactError extends Error {\n  code: string;\n  constructor(code: string, message?: string, options?: ErrorOptions) {\n    super(message, options);\n    this.code = code;\n    this.name = \"FhevmReactError\";\n  }\n}\n\nfunction throwFhevmError(\n  code: string,\n  message?: string,\n  cause?: unknown\n): never {\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\n}\n\nconst isFhevmInitialized = (): boolean => {\n  if (!isFhevmWindowType(window, console.log)) {\n    return false;\n  }\n  return window.relayerSDK.__initialized__ === true;\n};\n\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\n  const loader = new RelayerSDKLoader({ trace: console.log });\n  return loader.load();\n};\n\nconst fhevmInitSDK: FhevmInitSDKType = async (\n  options?: FhevmInitSDKOptions\n) => {\n  if (!isFhevmWindowType(window, console.log)) {\n    throw new Error(\"window.relayerSDK is not available\");\n  }\n  const result = await window.relayerSDK.initSDK(options);\n  window.relayerSDK.__initialized__ = result;\n  if (!result) {\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\n  }\n  return true;\n};\n\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\n  if (typeof a !== \"string\") {\n    return false;\n  }\n  if (!isAddress(a)) {\n    return false;\n  }\n  return true;\n}\n\nexport class FhevmAbortError extends Error {\n  constructor(message = \"FHEVM operation was cancelled\") {\n    super(message);\n    this.name = \"FhevmAbortError\";\n  }\n}\n\ntype FhevmRelayerStatusType =\n  | \"sdk-loading\"\n  | \"sdk-loaded\"\n  | \"sdk-initializing\"\n  | \"sdk-initialized\"\n  | \"creating\";\n\nasync function getChainId(\n  providerOrUrl: Eip1193Provider | string\n): Promise<number> {\n  if (typeof providerOrUrl === \"string\") {\n    const provider = new JsonRpcProvider(providerOrUrl);\n    return Number((await provider.getNetwork()).chainId);\n  }\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\n  return Number.parseInt(chainId as string, 16);\n}\n\nasync function getWeb3Client(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"web3_clientVersion\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"WEB3_CLIENTVERSION_ERROR\",\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\n  | {\n      ACLAddress: `0x${string}`;\n      InputVerifierAddress: `0x${string}`;\n      KMSVerifierAddress: `0x${string}`;\n    }\n  | undefined\n> {\n  const version = await getWeb3Client(rpcUrl);\n  if (\n    typeof version !== \"string\" ||\n    !version.toLowerCase().includes(\"hardhat\")\n  ) {\n    return undefined;\n  }\n  try {\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\n    if (!metadata || typeof metadata !== \"object\") {\n      return undefined;\n    }\n    if (\n      !(\n        \"ACLAddress\" in metadata &&\n        typeof metadata.ACLAddress === \"string\" &&\n        metadata.ACLAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"InputVerifierAddress\" in metadata &&\n        typeof metadata.InputVerifierAddress === \"string\" &&\n        metadata.InputVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"KMSVerifierAddress\" in metadata &&\n        typeof metadata.KMSVerifierAddress === \"string\" &&\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    return metadata;\n  } catch {\n    return undefined;\n  }\n}\n\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"FHEVM_RELAYER_METADATA_ERROR\",\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\ntype ResolveResult = MockResolveResult | GenericResolveResult;\n\nasync function resolve(\n  providerOrUrl: Eip1193Provider | string,\n  mockChains?: Record<number, string>\n): Promise<ResolveResult> {\n  const chainId = await getChainId(providerOrUrl);\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\n\n  const _mockChains: Record<number, string> = {\n    31337: \"http://localhost:8545\",\n    ...(mockChains ?? {}),\n  };\n\n  if (Object.hasOwn(_mockChains, chainId)) {\n    if (!rpcUrl) {\n      rpcUrl = _mockChains[chainId];\n    }\n    return { isMock: true, chainId, rpcUrl };\n  }\n\n  return { isMock: false, chainId, rpcUrl };\n}\n\nexport const createFhevmInstance = async (parameters: {\n  provider: Eip1193Provider | string;\n  mockChains?: Record<number, string>;\n  signal: AbortSignal;\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\n}): Promise<FhevmInstance> => {\n  const throwIfAborted = () => {\n    if (signal.aborted) throw new FhevmAbortError();\n  };\n\n  const notify = (status: FhevmRelayerStatusType) => {\n    if (onStatusChange) onStatusChange(status);\n  };\n\n  const {\n    signal,\n    onStatusChange,\n    provider: providerOrUrl,\n    mockChains,\n  } = parameters;\n\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\n\n  if (isMock) {\n    const fhevmRelayerMetadata =\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\n\n    if (fhevmRelayerMetadata) {\n      notify(\"creating\");\n\n      const fhevmMock = await import(\"./mock/fhevmMock\");\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\n        rpcUrl,\n        chainId,\n        metadata: fhevmRelayerMetadata,\n      });\n\n      throwIfAborted();\n      return mockInstance;\n    }\n  }\n\n  throwIfAborted();\n\n  if (!isFhevmWindowType(window, console.log)) {\n    notify(\"sdk-loading\");\n    await fhevmLoadSDK();\n    throwIfAborted();\n    notify(\"sdk-loaded\");\n  }\n\n  if (!isFhevmInitialized()) {\n    notify(\"sdk-initializing\");\n    await fhevmInitSDK();\n    throwIfAborted();\n    notify(\"sdk-initialized\");\n  }\n\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\n\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\n  if (!checkIsAddress(aclAddress)) {\n    throw new Error(`Invalid address: ${aclAddress}`);\n  }\n\n  const pub = await publicKeyStorageGet(aclAddress);\n  throwIfAborted();\n\n  const config: FhevmInstanceConfig = {\n    ...relayerSDK.SepoliaConfig,\n    network: providerOrUrl,\n    publicKey: pub.publicKey,\n    publicParams: pub.publicParams,\n  };\n\n  notify(\"creating\");\n\n  const instance = await relayerSDK.createInstance(config);\n\n  await publicKeyStorageSet(\n    aclAddress,\n    instance.getPublicKey(),\n    instance.getPublicParams(2048)\n  );\n\n  throwIfAborted();\n\n  return instance;\n};\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 450, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport type { FhevmInstance } from \"./fhevmTypes\";\nimport { createFhevmInstance } from \"./internal/fhevm\";\n\nfunction _assert(condition: boolean, message?: string): asserts condition {\n  if (!condition) {\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\n    console.error(m);\n    throw new Error(m);\n  }\n}\n\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\n\nexport function useFhevm(parameters: {\n  provider: string | ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  enabled?: boolean;\n  initialMockChains?: Readonly<Record<number, string>>;\n}): {\n  instance: FhevmInstance | undefined;\n  refresh: () => void;\n  error: Error | undefined;\n  status: FhevmGoState;\n} {\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\n\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\n    undefined\n  );\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\n  const [error, _setError] = useState<Error | undefined>(undefined);\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\n  const _abortControllerRef = useRef<AbortController | null>(null);\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\n    provider\n  );\n  const _chainIdRef = useRef<number | undefined>(chainId);\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\n    initialMockChains\n  );\n\n  const refresh = useCallback(() => {\n    if (_abortControllerRef.current) {\n      _providerRef.current = undefined;\n      _chainIdRef.current = undefined;\n      _abortControllerRef.current.abort();\n      _abortControllerRef.current = null;\n    }\n\n    _providerRef.current = provider;\n    _chainIdRef.current = chainId;\n\n    _setInstance(undefined);\n    _setError(undefined);\n    _setStatus(\"idle\");\n\n    if (provider !== undefined) {\n      _setProviderChanged((prev) => prev + 1);\n    }\n  }, [provider, chainId]);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  useEffect(() => {\n    _setIsRunning(enabled);\n  }, [enabled]);\n\n  useEffect(() => {\n    if (_isRunning === false) {\n      if (_abortControllerRef.current) {\n        _abortControllerRef.current.abort();\n        _abortControllerRef.current = null;\n      }\n      _setInstance(undefined);\n      _setError(undefined);\n      _setStatus(\"idle\");\n      return;\n    }\n\n    if (_isRunning === true) {\n      if (_providerRef.current === undefined) {\n        _setInstance(undefined);\n        _setError(undefined);\n        _setStatus(\"idle\");\n        return;\n      }\n\n      if (!_abortControllerRef.current) {\n        _abortControllerRef.current = new AbortController();\n      }\n\n      _assert(\n        !_abortControllerRef.current.signal.aborted,\n        \"!controllerRef.current.signal.aborted\"\n      );\n\n      _setStatus(\"loading\");\n      _setError(undefined);\n\n      const thisSignal = _abortControllerRef.current.signal;\n      const thisProvider = _providerRef.current;\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\n\n      createFhevmInstance({\n        signal: thisSignal,\n        provider: thisProvider,\n        mockChains: thisRpcUrlsByChainId,\n        onStatusChange: (s) =>\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\n      })\n        .then((i) => {\n          console.log(`[useFhevm] createFhevmInstance created!`);\n          if (thisSignal.aborted) return;\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(i);\n          _setError(undefined);\n          _setStatus(\"ready\");\n        })\n        .catch((e) => {\n          console.log(`Error Was thrown !!! error... ` + e.name);\n          if (thisSignal.aborted) return;\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(undefined);\n          _setError(e);\n          _setStatus(\"error\");\n        });\n    }\n  }, [_isRunning, _providerChanged]);\n\n  return { instance, refresh, error, status };\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 568, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useFhevm } from \"@/fhevm/useFhevm\";\nimport { useMetaMaskEthersSigner } from \"@/hooks/metamask/useMetaMaskEthersSigner\";\nimport Link from \"next/link\";\n\nexport default function Home() {\n  const { chainId, accounts, isConnected } = useMetaMaskEthersSigner();\n  const {\n    status: fhevmStatus,\n    error: fhevmError,\n  } = useFhevm({\n    provider: typeof window !== \"undefined\" ? window.ethereum : undefined,\n    chainId,\n    initialMockChains: { 31337: \"http://localhost:8545\" },\n    enabled: isConnected,\n  });\n\n  const actions = [\n    {\n      title: \"Forge Course\",\n      description: \"Create new skill training courses\",\n      icon: \"‚ú®\",\n      href: \"/forge-course\",\n      gradient: \"from-purple-500 to-pink-500\",\n    },\n    {\n      title: \"Submit Proof\",\n      description: \"Showcase your skill achievements\",\n      icon: \"üìù\",\n      href: \"/submit-proof\",\n      gradient: \"from-cyan-500 to-blue-500\",\n    },\n    {\n      title: \"Validate Proofs\",\n      description: \"Review skill proofs\",\n      icon: \"‚úì\",\n      href: \"/validate\",\n      gradient: \"from-green-500 to-emerald-500\",\n    },\n    {\n      title: \"My Badges\",\n      description: \"View earned achievements\",\n      icon: \"üèÜ\",\n      href: \"/badges\",\n      gradient: \"from-amber-500 to-orange-500\",\n    },\n  ];\n\n  const stats = [\n    { label: \"Forged Courses\", value: \"0\", icon: \"‚ú®\" },\n    { label: \"Completed Challenges\", value: \"0\", icon: \"‚ö°\" },\n    { label: \"Earned Badges\", value: \"0\", icon: \"üéñ\" },\n    { label: \"Total Score\", value: \"--\", icon: \"üíé\" },\n  ];\n\n  return (\n    <div className=\"min-h-[calc(100vh-5rem)] py-12\">\n      <div className=\"container mx-auto px-4\">\n        {/* Hero Section */}\n        <div className=\"mb-16 text-center\">\n          <div className=\"inline-flex items-center space-x-2 mb-6 glass rounded-full px-6 py-3 animate-slide-up\">\n            <div className=\"h-2 w-2 rounded-full bg-success animate-pulse\"></div>\n            <span className=\"text-sm font-medium\">SYSTEM ONLINE</span>\n          </div>\n\n          <h1 className=\"text-6xl md:text-8xl font-display font-black mb-6 animate-slide-up\">\n            <span className=\"gradient-text\">SkillForge</span>\n          </h1>\n          \n          <div className=\"flex items-center justify-center space-x-2 mb-6\">\n            <div className=\"h-1 w-16 bg-gradient-purple rounded-full\"></div>\n            <div className=\"h-1 w-1 rounded-full bg-white\"></div>\n            <div className=\"h-1 w-16 bg-gradient-cyan rounded-full\"></div>\n          </div>\n\n          <p className=\"text-xl md:text-2xl text-white/90 mb-8 font-light\">\n            Decentralized Skill Forging Platform Powered by FHEVM\n          </p>\n          \n          {/* Status Cards */}\n          <div className=\"flex flex-wrap justify-center gap-4 mb-8\">\n            <div className=\"glass-strong rounded-full px-6 py-3 shadow-glass\">\n              <span className=\"text-sm text-white/70\">Chain ID: </span>\n              <span className=\"font-mono font-bold gradient-text\">{chainId || \"Not Connected\"}</span>\n            </div>\n            <div className=\"glass-strong rounded-full px-6 py-3 shadow-glass\">\n              <span className=\"text-sm text-white/70\">FHEVM: </span>\n              <span className={`font-bold ${\n                fhevmStatus === \"ready\" ? \"text-success\" : \n                fhevmStatus === \"loading\" ? \"text-amber-400\" : \n                \"text-white/50\"\n              }`}>\n                {fhevmStatus === \"ready\" ? \"‚úì Ready\" : \n                 fhevmStatus === \"loading\" ? \"‚è≥ Loading\" : \n                 \"Standby\"}\n              </span>\n            </div>\n            {isConnected && (\n              <div className=\"glass-strong rounded-full px-6 py-3 shadow-glow\">\n                <span className=\"text-sm text-white/70\">Address: </span>\n                <span className=\"font-mono font-bold\">\n                  {accounts[0]?.slice(0, 6)}...{accounts[0]?.slice(-4)}\n                </span>\n              </div>\n            )}\n          </div>\n\n          {fhevmError && (\n            <div className=\"max-w-2xl mx-auto mb-8 glass-dark rounded-2xl p-4 border border-red-400/30\">\n              <p className=\"text-sm text-red-300\">\n                ‚ö†Ô∏è FHEVM Error: {fhevmError.message}\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 mb-16\">\n          {stats.map((stat, index) => (\n            <div\n              key={index}\n              className=\"glass-card rounded-3xl p-6 shadow-glass hover:shadow-glass-lg transition-all\"\n              style={{ animationDelay: `${index * 0.1}s` }}\n            >\n              <div className=\"text-5xl mb-3 animate-float\" style={{ animationDelay: `${index * 0.2}s` }}>\n                {stat.icon}\n              </div>\n              <div className=\"text-4xl font-display font-black gradient-text mb-2\">\n                {stat.value}\n              </div>\n              <div className=\"text-sm text-white/70 font-medium\">\n                {stat.label}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Actions Grid */}\n        <div>\n          <h2 className=\"text-3xl font-display font-bold text-white mb-8 text-center\">\n            Quick Actions\n          </h2>\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            {actions.map((action, index) => (\n              <Link\n                key={index}\n                href={action.href}\n                className=\"group relative glass-card rounded-3xl p-8 shadow-glass hover:shadow-glass-lg transition-all\"\n              >\n                <div className=\"absolute inset-0 bg-gradient-to-br opacity-0 group-hover:opacity-10 rounded-3xl transition-opacity\"></div>\n                \n                <div className=\"relative z-10\">\n                  <div className={`inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br ${action.gradient} text-3xl mb-6 shadow-glow transform group-hover:scale-110 group-hover:rotate-3 transition-all`}>\n                    {action.icon}\n                  </div>\n                  <h3 className=\"text-xl font-display font-bold text-white mb-2\">\n                    {action.title}\n                  </h3>\n                  <p className=\"text-sm text-white/70 mb-4\">\n                    {action.description}\n                  </p>\n                  <div className=\"flex items-center text-white font-semibold text-sm\">\n                    <span>Start</span>\n                    <svg className=\"w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                    </svg>\n                  </div>\n                </div>\n              </Link>\n            ))}\n          </div>\n        </div>\n\n        {/* Features Section */}\n        <div className=\"mt-20\">\n          <h2 className=\"text-3xl font-display font-bold text-white mb-8 text-center\">\n            Platform Features\n          </h2>\n          <div className=\"grid md:grid-cols-3 gap-6\">\n            <div className=\"glass-card rounded-3xl p-8 text-center shadow-glass hover:shadow-glass-lg transition-all\">\n              <div className=\"text-6xl mb-4 animate-float\">üîí</div>\n              <h3 className=\"text-xl font-display font-bold text-white mb-3\">\n                Fully Encrypted\n              </h3>\n              <div className=\"h-1 w-12 bg-gradient-purple mx-auto mb-4 rounded-full\"></div>\n              <p className=\"text-sm text-white/70 leading-relaxed\">\n                All skill data processed with FHEVM homomorphic encryption\n              </p>\n            </div>\n            <div className=\"glass-card rounded-3xl p-8 text-center shadow-glass hover:shadow-glass-lg transition-all\">\n              <div className=\"text-6xl mb-4 animate-float\" style={{ animationDelay: '0.2s' }}>‚õìÔ∏è</div>\n              <h3 className=\"text-xl font-display font-bold text-white mb-3\">\n                On-Chain Forge\n              </h3>\n              <div className=\"h-1 w-12 bg-gradient-cyan mx-auto mb-4 rounded-full\"></div>\n              <p className=\"text-sm text-white/70 leading-relaxed\">\n                All badges permanently recorded on blockchain, verifiable\n              </p>\n            </div>\n            <div className=\"glass-card rounded-3xl p-8 text-center shadow-glass hover:shadow-glass-lg transition-all\">\n              <div className=\"text-6xl mb-4 animate-float\" style={{ animationDelay: '0.4s' }}>üõ°Ô∏è</div>\n              <h3 className=\"text-xl font-display font-bold text-white mb-3\">\n                Smart Validation\n              </h3>\n              <div className=\"h-1 w-12 bg-gradient-purple mx-auto mb-4 rounded-full\"></div>\n              <p className=\"text-sm text-white/70 leading-relaxed\">\n                Validators review and score in encrypted state, protecting privacy\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Footer Decoration */}\n        <div className=\"mt-16 flex items-center justify-center space-x-3\">\n          <div className=\"h-px w-20 bg-gradient-to-r from-transparent to-white/30\"></div>\n          <div className=\"flex space-x-2\">\n            <div className=\"h-2 w-2 rounded-full bg-primary animate-pulse\"></div>\n            <div className=\"h-2 w-2 rounded-full bg-secondary animate-pulse\" style={{animationDelay: '0.3s'}}></div>\n            <div className=\"h-2 w-2 rounded-full bg-accent animate-pulse\" style={{animationDelay: '0.6s'}}></div>\n          </div>\n          <div className=\"h-px w-20 bg-gradient-to-l from-transparent to-white/30\"></div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1222, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/node_modules/idb/build/index.js"],"sourcesContent":["const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst transactionDoneMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    // This mapping exists in reverseTransformCache but doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(this.request);\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nconst advanceMethodProps = ['continue', 'continuePrimaryKey', 'advance'];\nconst methodMap = {};\nconst advanceResults = new WeakMap();\nconst ittrProxiedCursorToOriginalProxy = new WeakMap();\nconst cursorIteratorTraps = {\n    get(target, prop) {\n        if (!advanceMethodProps.includes(prop))\n            return target[prop];\n        let cachedFunc = methodMap[prop];\n        if (!cachedFunc) {\n            cachedFunc = methodMap[prop] = function (...args) {\n                advanceResults.set(this, ittrProxiedCursorToOriginalProxy.get(this)[prop](...args));\n            };\n        }\n        return cachedFunc;\n    },\n};\nasync function* iterate(...args) {\n    // tslint:disable-next-line:no-this-assignment\n    let cursor = this;\n    if (!(cursor instanceof IDBCursor)) {\n        cursor = await cursor.openCursor(...args);\n    }\n    if (!cursor)\n        return;\n    cursor = cursor;\n    const proxiedCursor = new Proxy(cursor, cursorIteratorTraps);\n    ittrProxiedCursorToOriginalProxy.set(proxiedCursor, cursor);\n    // Map this double-proxy back to the original, so other cursor methods work.\n    reverseTransformCache.set(proxiedCursor, unwrap(cursor));\n    while (cursor) {\n        yield proxiedCursor;\n        // If one of the advancing methods was not called, call continue().\n        cursor = await (advanceResults.get(proxiedCursor) || cursor.continue());\n        advanceResults.delete(proxiedCursor);\n    }\n}\nfunction isIteratorProp(target, prop) {\n    return ((prop === Symbol.asyncIterator &&\n        instanceOfAny(target, [IDBIndex, IDBObjectStore, IDBCursor])) ||\n        (prop === 'iterate' && instanceOfAny(target, [IDBIndex, IDBObjectStore])));\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get(target, prop, receiver) {\n        if (isIteratorProp(target, prop))\n            return iterate;\n        return oldTraps.get(target, prop, receiver);\n    },\n    has(target, prop) {\n        return isIteratorProp(target, prop) || oldTraps.has(target, prop);\n    },\n}));\n\nexport { deleteDB, openDB, unwrap, wrap };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}}]
}