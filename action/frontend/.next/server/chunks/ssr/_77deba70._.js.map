{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/components/WalletGuard.tsx"],"sourcesContent":["\"use client\";\n\nimport { ReactNode } from \"react\";\nimport { useMetaMaskEthersSigner } from \"@/hooks/metamask/useMetaMaskEthersSigner\";\n\nexport default function WalletGuard({ children }: { children: ReactNode }) {\n  const { isConnected, connect } = useMetaMaskEthersSigner();\n\n  if (!isConnected) {\n    return (\n      <div className=\"min-h-[calc(100vh-5rem)] flex items-center justify-center p-4\">\n        <div className=\"w-full max-w-md\">\n          <div className=\"glass-strong rounded-3xl p-10 shadow-glass-lg text-center\">\n            {/* Decorative background */}\n            <div className=\"absolute inset-0 bg-gradient-purple opacity-5 rounded-3xl blur-3xl\"></div>\n            \n            <div className=\"relative z-10\">\n              <div className=\"inline-flex h-24 w-24 items-center justify-center rounded-3xl bg-gradient-purple text-5xl mb-6 shadow-glow animate-float\">\n                ðŸ”—\n              </div>\n              <h2 className=\"text-3xl font-display font-black mb-3\">\n                <span className=\"gradient-text\">Connect Wallet</span>\n              </h2>\n              <div className=\"h-1 w-16 bg-gradient-purple mx-auto mb-6 rounded-full\"></div>\n              <p className=\"text-white/80 mb-8 leading-relaxed\">\n                Please connect your MetaMask wallet to access SkillForge\n              </p>\n              \n              <button\n                onClick={connect}\n                className=\"w-full py-4 glass-strong rounded-2xl font-bold shadow-glow hover:shadow-glow-cyan transition-all btn-glass group\"\n              >\n                <span className=\"flex items-center justify-center space-x-2\">\n                  <span>ðŸš€</span>\n                  <span>Connect MetaMask</span>\n                </span>\n              </button>\n              \n              <div className=\"mt-8 glass-dark rounded-2xl p-4\">\n                <div className=\"flex items-start space-x-3\">\n                  <span className=\"text-2xl\">ðŸ’¡</span>\n                  <p className=\"text-sm text-white/70 text-left\">\n                    Make sure you have MetaMask browser extension installed\n                  </p>\n                </div>\n              </div>\n\n              {/* Decorative elements */}\n              <div className=\"mt-8 flex items-center justify-center space-x-2\">\n                <div className=\"h-px w-12 bg-gradient-to-r from-transparent to-white/20\"></div>\n                <div className=\"flex space-x-1\">\n                  <div className=\"h-1.5 w-1.5 bg-primary rounded-full\"></div>\n                  <div className=\"h-1.5 w-1.5 bg-secondary rounded-full\"></div>\n                  <div className=\"h-1.5 w-1.5 bg-accent rounded-full\"></div>\n                </div>\n                <div className=\"h-px w-12 bg-gradient-to-l from-transparent to-white/20\"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAKe,SAAS,YAAY,EAAE,QAAQ,EAA2B;IACvE,MAAM,EAAE,WAAW,EAAE,OAAO,EAAE,GAAG,IAAA,wKAAuB;IAExD,IAAI,CAAC,aAAa;QAChB,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCAEb,8OAAC;4BAAI,WAAU;;;;;;sCAEf,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;8CAA2H;;;;;;8CAG1I,8OAAC;oCAAG,WAAU;8CACZ,cAAA,8OAAC;wCAAK,WAAU;kDAAgB;;;;;;;;;;;8CAElC,8OAAC;oCAAI,WAAU;;;;;;8CACf,8OAAC;oCAAE,WAAU;8CAAqC;;;;;;8CAIlD,8OAAC;oCACC,SAAS;oCACT,WAAU;8CAEV,cAAA,8OAAC;wCAAK,WAAU;;0DACd,8OAAC;0DAAK;;;;;;0DACN,8OAAC;0DAAK;;;;;;;;;;;;;;;;;8CAIV,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAK,WAAU;0DAAW;;;;;;0DAC3B,8OAAC;gDAAE,WAAU;0DAAkC;;;;;;;;;;;;;;;;;8CAOnD,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;;;;;sDACf,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;;;;;8DACf,8OAAC;oDAAI,WAAU;;;;;;8DACf,8OAAC;oDAAI,WAAU;;;;;;;;;;;;sDAEjB,8OAAC;4CAAI,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAO7B;IAEA,qBAAO;kBAAG;;AACZ","debugId":null}},
    {"offset": {"line": 218, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\n\n\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\nimport { SDK_CDN_URL } from \"./constants\";\n\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\n\nexport class RelayerSDKLoader {\n  private _trace?: TraceType;\n\n  constructor(options: { trace?: TraceType }) {\n    this._trace = options.trace;\n  }\n\n  public isLoaded() {\n    if (typeof window === \"undefined\") {\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\n    }\n    return isFhevmWindowType(window, this._trace);\n  }\n\n  public load(): Promise<void> {\n    console.log(\"[RelayerSDKLoader] load...\");\n    if (typeof window === \"undefined\") {\n      console.log(\"[RelayerSDKLoader] window === undefined\");\n      return Promise.reject(\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\n      );\n    }\n\n    if (\"relayerSDK\" in window) {\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\n      }\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve, reject) => {\n      const existingScript = document.querySelector(\n        `script[src=\"${SDK_CDN_URL}\"]`\n      );\n      if (existingScript) {\n        if (!isFhevmWindowType(window, this._trace)) {\n          reject(\n            new Error(\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\n            )\n          );\n        }\n        resolve();\n        return;\n      }\n\n      const script = document.createElement(\"script\");\n      script.src = SDK_CDN_URL;\n      script.type = \"text/javascript\";\n      script.async = true;\n\n      script.onload = () => {\n        if (!isFhevmWindowType(window, this._trace)) {\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\n          reject(\n            new Error(\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\n            )\n          );\n        }\n        resolve();\n      };\n\n      script.onerror = () => {\n        console.log(\"[RelayerSDKLoader] script onerror... \");\n        reject(\n          new Error(\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\n          )\n        );\n      };\n\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\n      document.head.appendChild(script);\n      console.log(\"[RelayerSDKLoader] script added!\")\n    });\n  }\n}\n\nfunction isFhevmRelayerSDKType(\n  o: unknown,\n  trace?: TraceType\n): o is FhevmRelayerSDKType {\n  if (typeof o === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\n    return false;\n  }\n  if (o === null) {\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\n    return false;\n  }\n  if (typeof o !== \"object\") {\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\n    return false;\n  }\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\n    return false;\n  }\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\n    return false;\n  }\n  if (\"__initialized__\" in o) {\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isFhevmWindowType(\n  win: unknown,\n  trace?: TraceType\n): win is FhevmWindowType {\n  if (typeof win === \"undefined\") {\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\n    return false;\n  }\n  if (win === null) {\n    trace?.(\"RelayerSDKLoader: window object is null\");\n    return false;\n  }\n  if (typeof win !== \"object\") {\n    trace?.(\"RelayerSDKLoader: window is not an object\");\n    return false;\n  }\n  if (!(\"relayerSDK\" in win)) {\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\n    return false;\n  }\n  return isFhevmRelayerSDKType(win.relayerSDK);\n}\n\nfunction objHasProperty<\n  T extends object,\n  K extends PropertyKey,\n  V extends string\n>(\n  obj: T,\n  propertyName: K,\n  propertyType: V,\n  trace?: TraceType\n): obj is T &\n  Record<\n    K,\n    V extends \"string\"\n      ? string\n      : V extends \"number\"\n      ? number\n      : V extends \"object\"\n      ? object\n      : V extends \"boolean\"\n      ? boolean\n      : V extends \"function\"\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (...args: any[]) => any\n      : unknown\n  > {\n  if (!obj || typeof obj !== \"object\") {\n    return false;\n  }\n\n  if (!(propertyName in obj)) {\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\n    return false;\n  }\n\n  const value = (obj as Record<K, unknown>)[propertyName];\n\n  if (value === null || value === undefined) {\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\n    return false;\n  }\n\n  if (typeof value !== propertyType) {\n    trace?.(\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\n    );\n    return false;\n  }\n\n  return true;\n}\n\n\n"],"names":[],"mappings":";;;;;;AACA;;AAIO,MAAM;IACH,OAAmB;IAE3B,YAAY,OAA8B,CAAE;QAC1C,IAAI,CAAC,MAAM,GAAG,QAAQ,KAAK;IAC7B;IAEO,WAAW;QAChB,wCAAmC;YACjC,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,kBAAkB,QAAQ,IAAI,CAAC,MAAM;IAC9C;IAEO,OAAsB;QAC3B,QAAQ,GAAG,CAAC;QACZ,wCAAmC;YACjC,QAAQ,GAAG,CAAC;YACZ,OAAO,QAAQ,MAAM,CACnB,IAAI,MAAM;QAEd;;;IAwDF;AACF;AAEA,SAAS,sBACP,CAAU,EACV,KAAiB;IAEjB,IAAI,OAAO,MAAM,aAAa;QAC5B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,MAAM,MAAM;QACd,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,MAAM,UAAU;QACzB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,WAAW,YAAY,QAAQ;QACpD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,kBAAkB,YAAY,QAAQ;QAC3D,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,eAAe,GAAG,iBAAiB,UAAU,QAAQ;QACxD,QAAQ;QACR,OAAO;IACT;IACA,IAAI,qBAAqB,GAAG;QAC1B,IAAI,EAAE,eAAe,KAAK,QAAQ,EAAE,eAAe,KAAK,OAAO;YAC7D,QAAQ;YACR,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,kBACd,GAAY,EACZ,KAAiB;IAEjB,IAAI,OAAO,QAAQ,aAAa;QAC9B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,QAAQ,MAAM;QAChB,QAAQ;QACR,OAAO;IACT;IACA,IAAI,OAAO,QAAQ,UAAU;QAC3B,QAAQ;QACR,OAAO;IACT;IACA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ;QACR,OAAO;IACT;IACA,OAAO,sBAAsB,IAAI,UAAU;AAC7C;AAEA,SAAS,eAKP,GAAM,EACN,YAAe,EACf,YAAe,EACf,KAAiB;IAiBjB,IAAI,CAAC,OAAO,OAAO,QAAQ,UAAU;QACnC,OAAO;IACT;IAEA,IAAI,CAAC,CAAC,gBAAgB,GAAG,GAAG;QAC1B,QAAQ,CAAC,0BAA0B,EAAE,OAAO,cAAc,CAAC,CAAC;QAC5D,OAAO;IACT;IAEA,MAAM,QAAQ,AAAC,GAA0B,CAAC,aAAa;IAEvD,IAAI,UAAU,QAAQ,UAAU,WAAW;QACzC,QAAQ,CAAC,kBAAkB,EAAE,OAAO,cAAc,sBAAsB,CAAC;QACzE,OAAO;IACT;IAEA,IAAI,OAAO,UAAU,cAAc;QACjC,QACE,CAAC,kBAAkB,EAAE,OAAO,cAAc,UAAU,EAAE,aAAa,CAAC,CAAC;QAEvE,OAAO;IACT;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 331, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\n\ntype FhevmStoredPublicKey = {\n  publicKeyId: string;\n  publicKey: Uint8Array;\n};\n\ntype FhevmStoredPublicParams = {\n  publicParamsId: string;\n  publicParams: Uint8Array;\n};\n\ninterface PublicParamsDB extends DBSchema {\n  publicKeyStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicKey;\n    };\n  };\n  paramsStore: {\n    key: string;\n    value: {\n      acl: `0x${string}`;\n      value: FhevmStoredPublicParams;\n    };\n  };\n}\n\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\n\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\n  if (__dbPromise) {\n    return __dbPromise;\n  }\n  if (typeof window === \"undefined\") {\n    return undefined;\n  }\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\n    upgrade(db) {\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\n      }\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\n      }\n    },\n  });\n  return __dbPromise;\n}\n\ntype FhevmInstanceConfigPublicKey = {\n  data: Uint8Array | null;\n  id: string | null;\n};\n\ntype FhevmInstanceConfigPublicParams = {\n  \"2048\": {\n    publicParamsId: string;\n    publicParams: Uint8Array;\n  };\n};\n\nfunction assertFhevmStoredPublicKey(\n  value: unknown\n): asserts value is FhevmStoredPublicKey | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicKey must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicKeyId\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\n  }\n  if (typeof value.publicKeyId !== \"string\") {\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\n  }\n  if (!(\"publicKey\" in value)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\n  }\n  if (!(value.publicKey instanceof Uint8Array)) {\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\n  }\n}\n\nfunction assertFhevmStoredPublicParams(\n  value: unknown\n): asserts value is FhevmStoredPublicParams | null {\n  if (typeof value !== \"object\") {\n    throw new Error(`FhevmStoredPublicParams must be an object`);\n  }\n  if (value === null) {\n    return;\n  }\n  if (!(\"publicParamsId\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\n  }\n  if (typeof value.publicParamsId !== \"string\") {\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\n  }\n  if (!(\"publicParams\" in value)) {\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\n  }\n  if (!(value.publicParams instanceof Uint8Array)) {\n    throw new Error(\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\n    );\n  }\n}\n\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\n  publicKey?: FhevmInstanceConfigPublicKey;\n  publicParams: FhevmInstanceConfigPublicParams | null;\n}> {\n  const db = await _getDB();\n  if (!db) {\n    return { publicParams: null };\n  }\n\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\n  try {\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\n    if (pk?.value) {\n      assertFhevmStoredPublicKey(pk.value);\n      storedPublicKey = pk.value;\n    }\n  } catch {\n    //\n  }\n\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\n  try {\n    const pp = await db.get(\"paramsStore\", aclAddress);\n    if (pp?.value) {\n      assertFhevmStoredPublicParams(pp.value);\n      storedPublicParams = pp.value;\n    }\n  } catch {\n    //\n  }\n\n  const publicKeyData = storedPublicKey?.publicKey;\n  const publicKeyId = storedPublicKey?.publicKeyId;\n  const publicParams = storedPublicParams\n    ? {\n        \"2048\": storedPublicParams,\n      }\n    : null;\n\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\n\n  if (publicKeyId && publicKeyData) {\n    publicKey = {\n      id: publicKeyId,\n      data: publicKeyData,\n    };\n  }\n\n  return {\n    ...(publicKey !== undefined && { publicKey }),\n    publicParams,\n  };\n}\n\nexport async function publicKeyStorageSet(\n  aclAddress: `0x${string}`,\n  publicKey: FhevmStoredPublicKey | null,\n  publicParams: FhevmStoredPublicParams | null\n) {\n  assertFhevmStoredPublicKey(publicKey);\n  assertFhevmStoredPublicParams(publicParams);\n\n  const db = await _getDB();\n  if (!db) {\n    return;\n  }\n\n  if (publicKey) {\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\n  }\n\n  if (publicParams) {\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;;AAAA;;AA6BA,IAAI,cAAiE;AAErE,eAAe;IACb,IAAI,aAAa;QACf,OAAO;IACT;IACA,wCAAmC;QACjC,OAAO;IACT;;;AAYF;AAcA,SAAS,2BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,sCAAsC,CAAC;IAC1D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,iBAAiB,KAAK,GAAG;QAC7B,MAAM,IAAI,MAAM,CAAC,+CAA+C,CAAC;IACnE;IACA,IAAI,OAAO,MAAM,WAAW,KAAK,UAAU;QACzC,MAAM,IAAI,MAAM,CAAC,iDAAiD,CAAC;IACrE;IACA,IAAI,CAAC,CAAC,eAAe,KAAK,GAAG;QAC3B,MAAM,IAAI,MAAM,CAAC,6CAA6C,CAAC;IACjE;IACA,IAAI,CAAC,CAAC,MAAM,SAAS,YAAY,UAAU,GAAG;QAC5C,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;AACF;AAEA,SAAS,8BACP,KAAc;IAEd,IAAI,OAAO,UAAU,UAAU;QAC7B,MAAM,IAAI,MAAM,CAAC,yCAAyC,CAAC;IAC7D;IACA,IAAI,UAAU,MAAM;QAClB;IACF;IACA,IAAI,CAAC,CAAC,oBAAoB,KAAK,GAAG;QAChC,MAAM,IAAI,MAAM,CAAC,qDAAqD,CAAC;IACzE;IACA,IAAI,OAAO,MAAM,cAAc,KAAK,UAAU;QAC5C,MAAM,IAAI,MAAM,CAAC,uDAAuD,CAAC;IAC3E;IACA,IAAI,CAAC,CAAC,kBAAkB,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAM,CAAC,mDAAmD,CAAC;IACvE;IACA,IAAI,CAAC,CAAC,MAAM,YAAY,YAAY,UAAU,GAAG;QAC/C,MAAM,IAAI,MACR,CAAC,yDAAyD,CAAC;IAE/D;AACF;AAEO,eAAe,oBAAoB,UAAyB;IAIjE,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP,OAAO;YAAE,cAAc;QAAK;IAC9B;IAEA,IAAI,kBAA+C;IACnD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,kBAAkB;QAC1C,IAAI,IAAI,OAAO;YACb,2BAA2B,GAAG,KAAK;YACnC,kBAAkB,GAAG,KAAK;QAC5B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,IAAI,qBAAqD;IACzD,IAAI;QACF,MAAM,KAAK,MAAM,GAAG,GAAG,CAAC,eAAe;QACvC,IAAI,IAAI,OAAO;YACb,8BAA8B,GAAG,KAAK;YACtC,qBAAqB,GAAG,KAAK;QAC/B;IACF,EAAE,OAAM;IACN,EAAE;IACJ;IAEA,MAAM,gBAAgB,iBAAiB;IACvC,MAAM,cAAc,iBAAiB;IACrC,MAAM,eAAe,qBACjB;QACE,QAAQ;IACV,IACA;IAEJ,IAAI,YAAsD;IAE1D,IAAI,eAAe,eAAe;QAChC,YAAY;YACV,IAAI;YACJ,MAAM;QACR;IACF;IAEA,OAAO;QACL,GAAI,cAAc,aAAa;YAAE;QAAU,CAAC;QAC5C;IACF;AACF;AAEO,eAAe,oBACpB,UAAyB,EACzB,SAAsC,EACtC,YAA4C;IAE5C,2BAA2B;IAC3B,8BAA8B;IAE9B,MAAM,KAAK,MAAM;IACjB,IAAI,CAAC,IAAI;QACP;IACF;IAEA,IAAI,WAAW;QACb,MAAM,GAAG,GAAG,CAAC,kBAAkB;YAAE,KAAK;YAAY,OAAO;QAAU;IACrE;IAEA,IAAI,cAAc;QAChB,MAAM,GAAG,GAAG,CAAC,eAAe;YAAE,KAAK;YAAY,OAAO;QAAa;IACrE;AACF","debugId":null}},
    {"offset": {"line": 460, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\nimport type {\n  FhevmInitSDKOptions,\n  FhevmInitSDKType,\n  FhevmLoadSDKType,\n  FhevmWindowType,\n} from \"./fhevmTypes\";\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\nimport { FhevmInstance, FhevmInstanceConfig } from \"../../fhevmTypes\";\n\nexport class FhevmReactError extends Error {\n  code: string;\n  constructor(code: string, message?: string, options?: ErrorOptions) {\n    super(message, options);\n    this.code = code;\n    this.name = \"FhevmReactError\";\n  }\n}\n\nfunction throwFhevmError(\n  code: string,\n  message?: string,\n  cause?: unknown\n): never {\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\n}\n\nconst isFhevmInitialized = (): boolean => {\n  if (!isFhevmWindowType(window, console.log)) {\n    return false;\n  }\n  return window.relayerSDK.__initialized__ === true;\n};\n\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\n  const loader = new RelayerSDKLoader({ trace: console.log });\n  return loader.load();\n};\n\nconst fhevmInitSDK: FhevmInitSDKType = async (\n  options?: FhevmInitSDKOptions\n) => {\n  if (!isFhevmWindowType(window, console.log)) {\n    throw new Error(\"window.relayerSDK is not available\");\n  }\n  const result = await window.relayerSDK.initSDK(options);\n  window.relayerSDK.__initialized__ = result;\n  if (!result) {\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\n  }\n  return true;\n};\n\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\n  if (typeof a !== \"string\") {\n    return false;\n  }\n  if (!isAddress(a)) {\n    return false;\n  }\n  return true;\n}\n\nexport class FhevmAbortError extends Error {\n  constructor(message = \"FHEVM operation was cancelled\") {\n    super(message);\n    this.name = \"FhevmAbortError\";\n  }\n}\n\ntype FhevmRelayerStatusType =\n  | \"sdk-loading\"\n  | \"sdk-loaded\"\n  | \"sdk-initializing\"\n  | \"sdk-initialized\"\n  | \"creating\";\n\nasync function getChainId(\n  providerOrUrl: Eip1193Provider | string\n): Promise<number> {\n  if (typeof providerOrUrl === \"string\") {\n    const provider = new JsonRpcProvider(providerOrUrl);\n    return Number((await provider.getNetwork()).chainId);\n  }\n  const chainId = await providerOrUrl.request({ method: \"eth_chainId\" });\n  return Number.parseInt(chainId as string, 16);\n}\n\nasync function getWeb3Client(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"web3_clientVersion\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"WEB3_CLIENTVERSION_ERROR\",\n      `The URL ${rpcUrl} is not a Web3 node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\n  | {\n      ACLAddress: `0x${string}`;\n      InputVerifierAddress: `0x${string}`;\n      KMSVerifierAddress: `0x${string}`;\n    }\n  | undefined\n> {\n  const version = await getWeb3Client(rpcUrl);\n  if (\n    typeof version !== \"string\" ||\n    !version.toLowerCase().includes(\"hardhat\")\n  ) {\n    return undefined;\n  }\n  try {\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\n    if (!metadata || typeof metadata !== \"object\") {\n      return undefined;\n    }\n    if (\n      !(\n        \"ACLAddress\" in metadata &&\n        typeof metadata.ACLAddress === \"string\" &&\n        metadata.ACLAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"InputVerifierAddress\" in metadata &&\n        typeof metadata.InputVerifierAddress === \"string\" &&\n        metadata.InputVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    if (\n      !(\n        \"KMSVerifierAddress\" in metadata &&\n        typeof metadata.KMSVerifierAddress === \"string\" &&\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\n      )\n    ) {\n      return undefined;\n    }\n    return metadata;\n  } catch {\n    return undefined;\n  }\n}\n\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\n  const rpc = new JsonRpcProvider(rpcUrl);\n  try {\n    const version = await rpc.send(\"fhevm_relayer_metadata\", []);\n    return version;\n  } catch (e) {\n    throwFhevmError(\n      \"FHEVM_RELAYER_METADATA_ERROR\",\n      `The URL ${rpcUrl} is not a FHEVM Hardhat node or is not reachable. Please check the endpoint.`,\n      e\n    );\n  } finally {\n    rpc.destroy();\n  }\n}\n\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\ntype ResolveResult = MockResolveResult | GenericResolveResult;\n\nasync function resolve(\n  providerOrUrl: Eip1193Provider | string,\n  mockChains?: Record<number, string>\n): Promise<ResolveResult> {\n  const chainId = await getChainId(providerOrUrl);\n  let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\n\n  const _mockChains: Record<number, string> = {\n    31337: \"http://localhost:8545\",\n    ...(mockChains ?? {}),\n  };\n\n  if (Object.hasOwn(_mockChains, chainId)) {\n    if (!rpcUrl) {\n      rpcUrl = _mockChains[chainId];\n    }\n    return { isMock: true, chainId, rpcUrl };\n  }\n\n  return { isMock: false, chainId, rpcUrl };\n}\n\nexport const createFhevmInstance = async (parameters: {\n  provider: Eip1193Provider | string;\n  mockChains?: Record<number, string>;\n  signal: AbortSignal;\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\n}): Promise<FhevmInstance> => {\n  const throwIfAborted = () => {\n    if (signal.aborted) throw new FhevmAbortError();\n  };\n\n  const notify = (status: FhevmRelayerStatusType) => {\n    if (onStatusChange) onStatusChange(status);\n  };\n\n  const {\n    signal,\n    onStatusChange,\n    provider: providerOrUrl,\n    mockChains,\n  } = parameters;\n\n  const { isMock, rpcUrl, chainId } = await resolve(providerOrUrl, mockChains);\n\n  if (isMock) {\n    const fhevmRelayerMetadata =\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\n\n    if (fhevmRelayerMetadata) {\n      notify(\"creating\");\n\n      const fhevmMock = await import(\"./mock/fhevmMock\");\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\n        rpcUrl,\n        chainId,\n        metadata: fhevmRelayerMetadata,\n      });\n\n      throwIfAborted();\n      return mockInstance;\n    }\n  }\n\n  throwIfAborted();\n\n  if (!isFhevmWindowType(window, console.log)) {\n    notify(\"sdk-loading\");\n    await fhevmLoadSDK();\n    throwIfAborted();\n    notify(\"sdk-loaded\");\n  }\n\n  if (!isFhevmInitialized()) {\n    notify(\"sdk-initializing\");\n    await fhevmInitSDK();\n    throwIfAborted();\n    notify(\"sdk-initialized\");\n  }\n\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\n\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\n  if (!checkIsAddress(aclAddress)) {\n    throw new Error(`Invalid address: ${aclAddress}`);\n  }\n\n  const pub = await publicKeyStorageGet(aclAddress);\n  throwIfAborted();\n\n  const config: FhevmInstanceConfig = {\n    ...relayerSDK.SepoliaConfig,\n    network: providerOrUrl,\n    publicKey: pub.publicKey,\n    publicParams: pub.publicParams,\n  };\n\n  notify(\"creating\");\n\n  const instance = await relayerSDK.createInstance(config);\n\n  await publicKeyStorageSet(\n    aclAddress,\n    instance.getPublicKey(),\n    instance.getPublicParams(2048)\n  );\n\n  throwIfAborted();\n\n  return instance;\n};\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 664, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport type { FhevmInstance } from \"./fhevmTypes\";\nimport { createFhevmInstance } from \"./internal/fhevm\";\n\nfunction _assert(condition: boolean, message?: string): asserts condition {\n  if (!condition) {\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\n    console.error(m);\n    throw new Error(m);\n  }\n}\n\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\n\nexport function useFhevm(parameters: {\n  provider: string | ethers.Eip1193Provider | undefined;\n  chainId: number | undefined;\n  enabled?: boolean;\n  initialMockChains?: Readonly<Record<number, string>>;\n}): {\n  instance: FhevmInstance | undefined;\n  refresh: () => void;\n  error: Error | undefined;\n  status: FhevmGoState;\n} {\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\n\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\n    undefined\n  );\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\n  const [error, _setError] = useState<Error | undefined>(undefined);\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\n  const _abortControllerRef = useRef<AbortController | null>(null);\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\n    provider\n  );\n  const _chainIdRef = useRef<number | undefined>(chainId);\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\n    initialMockChains\n  );\n\n  const refresh = useCallback(() => {\n    if (_abortControllerRef.current) {\n      _providerRef.current = undefined;\n      _chainIdRef.current = undefined;\n      _abortControllerRef.current.abort();\n      _abortControllerRef.current = null;\n    }\n\n    _providerRef.current = provider;\n    _chainIdRef.current = chainId;\n\n    _setInstance(undefined);\n    _setError(undefined);\n    _setStatus(\"idle\");\n\n    if (provider !== undefined) {\n      _setProviderChanged((prev) => prev + 1);\n    }\n  }, [provider, chainId]);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  useEffect(() => {\n    _setIsRunning(enabled);\n  }, [enabled]);\n\n  useEffect(() => {\n    if (_isRunning === false) {\n      if (_abortControllerRef.current) {\n        _abortControllerRef.current.abort();\n        _abortControllerRef.current = null;\n      }\n      _setInstance(undefined);\n      _setError(undefined);\n      _setStatus(\"idle\");\n      return;\n    }\n\n    if (_isRunning === true) {\n      if (_providerRef.current === undefined) {\n        _setInstance(undefined);\n        _setError(undefined);\n        _setStatus(\"idle\");\n        return;\n      }\n\n      if (!_abortControllerRef.current) {\n        _abortControllerRef.current = new AbortController();\n      }\n\n      _assert(\n        !_abortControllerRef.current.signal.aborted,\n        \"!controllerRef.current.signal.aborted\"\n      );\n\n      _setStatus(\"loading\");\n      _setError(undefined);\n\n      const thisSignal = _abortControllerRef.current.signal;\n      const thisProvider = _providerRef.current;\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\n\n      createFhevmInstance({\n        signal: thisSignal,\n        provider: thisProvider,\n        mockChains: thisRpcUrlsByChainId,\n        onStatusChange: (s) =>\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\n      })\n        .then((i) => {\n          console.log(`[useFhevm] createFhevmInstance created!`);\n          if (thisSignal.aborted) return;\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(i);\n          _setError(undefined);\n          _setStatus(\"ready\");\n        })\n        .catch((e) => {\n          console.log(`Error Was thrown !!! error... ` + e.name);\n          if (thisSignal.aborted) return;\n\n          _assert(\n            thisProvider === _providerRef.current,\n            \"thisProvider === _providerRef.current\"\n          );\n\n          _setInstance(undefined);\n          _setError(e);\n          _setStatus(\"error\");\n        });\n    }\n  }, [_isRunning, _providerChanged]);\n\n  return { instance, refresh, error, status };\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 782, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/GenericStringStorage.ts"],"sourcesContent":["export interface GenericStringStorage {\n  getItem(key: string): string | Promise<string | null> | null;\n  setItem(key: string, value: string): void | Promise<void>;\n  removeItem(key: string): void | Promise<void>;\n}\n\nexport class GenericStringInMemoryStorage implements GenericStringStorage {\n  #store = new Map<string, string>();\n\n  getItem(key: string): string | Promise<string | null> | null {\n    return this.#store.has(key) ? this.#store.get(key)! : null;\n  }\n  setItem(key: string, value: string): void | Promise<void> {\n    this.#store.set(key, value);\n  }\n  removeItem(key: string): void | Promise<void> {\n    this.#store.delete(key);\n  }\n}\n"],"names":[],"mappings":";;;;AAMO,MAAM;IACX,CAAA,KAAM,GAAG,IAAI,MAAsB;IAEnC,QAAQ,GAAW,EAA0C;QAC3D,OAAO,IAAI,CAAC,CAAA,KAAM,CAAC,GAAG,CAAC,OAAO,IAAI,CAAC,CAAA,KAAM,CAAC,GAAG,CAAC,OAAQ;IACxD;IACA,QAAQ,GAAW,EAAE,KAAa,EAAwB;QACxD,IAAI,CAAC,CAAA,KAAM,CAAC,GAAG,CAAC,KAAK;IACvB;IACA,WAAW,GAAW,EAAwB;QAC5C,IAAI,CAAC,CAAA,KAAM,CAAC,MAAM,CAAC;IACrB;AACF","debugId":null}},
    {"offset": {"line": 802, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/hooks/useInMemoryStorage.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo } from \"react\";\nimport {\n  GenericStringInMemoryStorage,\n  GenericStringStorage,\n} from \"@/fhevm/GenericStringStorage\";\n\nexport function useInMemoryStorage(): {\n  storage: GenericStringStorage;\n} {\n  const storage = useMemo(() => new GenericStringInMemoryStorage(), []);\n  return { storage };\n}\n\n\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAQO,SAAS;IAGd,MAAM,UAAU,IAAA,gNAAO,EAAC,IAAM,IAAI,6JAA4B,IAAI,EAAE;IACpE,OAAO;QAAE;IAAQ;AACnB","debugId":null}},
    {"offset": {"line": 821, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\nimport {\n  EIP712Type,\n  FhevmDecryptionSignatureType,\n  FhevmInstance,\n} from \"./fhevmTypes\";\nimport { GenericStringStorage } from \"./GenericStringStorage\";\n\nfunction _timestampNow(): number {\n  return Math.floor(Date.now() / 1000);\n}\n\nclass FhevmDecryptionSignatureStorageKey {\n  #contractAddresses: `0x${string}`[];\n  #userAddress: `0x${string}`;\n  #publicKey: string | undefined;\n  #key: string;\n\n  constructor(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ) {\n    if (!ethers.isAddress(userAddress)) {\n      throw new TypeError(`Invalid address ${userAddress}`);\n    }\n\n    const sortedContractAddresses = (\n      contractAddresses as `0x${string}`[]\n    ).sort();\n\n    const emptyEIP712 = instance.createEIP712(\n      publicKey ?? ethers.ZeroAddress,\n      sortedContractAddresses,\n      0,\n      0\n    );\n\n    try {\n      const hash = ethers.TypedDataEncoder.hash(\n        emptyEIP712.domain,\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\n        emptyEIP712.message\n      );\n\n      this.#contractAddresses = sortedContractAddresses;\n      this.#userAddress = userAddress as `0x${string}`;\n      this.#key = `${userAddress}:${hash}`;\n    } catch (e) {\n      console.log(e);\n      throw e;\n    }\n  }\n\n  get contractAddresses(): `0x${string}`[] {\n    return this.#contractAddresses;\n  }\n\n  get userAddress(): `0x${string}` {\n    return this.#userAddress;\n  }\n\n  get publicKey(): string | undefined {\n    return this.#publicKey;\n  }\n\n  get key(): string {\n    return this.#key;\n  }\n}\n\nexport class FhevmDecryptionSignature {\n  #publicKey: string;\n  #privateKey: string;\n  #signature: string;\n  #startTimestamp: number;\n  #durationDays: number;\n  #userAddress: `0x${string}`;\n  #contractAddresses: `0x${string}`[];\n  #eip712: EIP712Type;\n\n  private constructor(parameters: FhevmDecryptionSignatureType) {\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\n    }\n    this.#publicKey = parameters.publicKey;\n    this.#privateKey = parameters.privateKey;\n    this.#signature = parameters.signature;\n    this.#startTimestamp = parameters.startTimestamp;\n    this.#durationDays = parameters.durationDays;\n    this.#userAddress = parameters.userAddress;\n    this.#contractAddresses = parameters.contractAddresses;\n    this.#eip712 = parameters.eip712;\n  }\n\n  public get privateKey() {\n    return this.#privateKey;\n  }\n\n  public get publicKey() {\n    return this.#publicKey;\n  }\n\n  public get signature() {\n    return this.#signature;\n  }\n\n  public get contractAddresses() {\n    return this.#contractAddresses;\n  }\n\n  public get startTimestamp() {\n    return this.#startTimestamp;\n  }\n\n  public get durationDays() {\n    return this.#durationDays;\n  }\n\n  public get userAddress() {\n    return this.#userAddress;\n  }\n\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\n    if (!s || typeof s !== \"object\") {\n      return false;\n    }\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\n      return false;\n    }\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\n      return false;\n    }\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\n      return false;\n    }\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\n      return false;\n    }\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\n      return false;\n    }\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\n      return false;\n    }\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\n    }\n    if (\n      !(\n        \"userAddress\" in s &&\n        typeof s.userAddress === \"string\" &&\n        s.userAddress.startsWith(\"0x\")\n      )\n    ) {\n      return false;\n    }\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\n      return false;\n    }\n\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\n      return false;\n    }\n    if (\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\n    ) {\n      return false;\n    }\n    if (!(\"message\" in s.eip712)) {\n      return false;\n    }\n    if (\n      !(\n        \"types\" in s.eip712 &&\n        typeof s.eip712.types === \"object\" &&\n        s.eip712.types !== null\n      )\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  toJSON() {\n    return {\n      publicKey: this.#publicKey,\n      privateKey: this.#privateKey,\n      signature: this.#signature,\n      startTimestamp: this.#startTimestamp,\n      durationDays: this.#durationDays,\n      userAddress: this.#userAddress,\n      contractAddresses: this.#contractAddresses,\n      eip712: this.#eip712,\n    };\n  }\n\n  static fromJSON(json: unknown) {\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\n    return new FhevmDecryptionSignature(data);\n  }\n\n  isValid(): boolean {\n    return (\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\n    );\n  }\n\n  async saveToGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    withPublicKey: boolean\n  ) {\n    try {\n      const value = JSON.stringify(this);\n\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        this.#contractAddresses,\n        this.#userAddress,\n        withPublicKey ? this.#publicKey : undefined\n      );\n      await storage.setItem(storageKey.key, value);\n      console.log(\n        `signature saved! contracts=${this.#contractAddresses.length}`\n      );\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\n      );\n    }\n  }\n\n  static async loadFromGenericStringStorage(\n    storage: GenericStringStorage,\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    userAddress: string,\n    publicKey?: string\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\n        instance,\n        contractAddresses,\n        userAddress,\n        publicKey\n      );\n\n      const result = await storage.getItem(storageKey.key);\n\n      if (!result) {\n        console.warn(`Could not load signature! key=${storageKey.key}`);\n        return null;\n      }\n\n      try {\n        const kps = FhevmDecryptionSignature.fromJSON(result);\n        if (!kps.isValid()) {\n          return null;\n        }\n\n        return kps;\n      } catch {\n        return null;\n      }\n    } catch {\n      console.error(\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\n      );\n      return null;\n    }\n  }\n\n  static async new(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    publicKey: string,\n    privateKey: string,\n    signer: ethers.Signer\n  ): Promise<FhevmDecryptionSignature | null> {\n    try {\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\n      const startTimestamp = _timestampNow();\n      const durationDays = 365;\n      const eip712 = instance.createEIP712(\n        publicKey,\n        contractAddresses,\n        startTimestamp,\n        durationDays\n      );\n      const signature = await signer.signTypedData(\n        eip712.domain,\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\n        eip712.message\n      );\n      return new FhevmDecryptionSignature({\n        publicKey,\n        privateKey,\n        contractAddresses: contractAddresses as `0x${string}`[],\n        startTimestamp,\n        durationDays,\n        signature,\n        eip712: eip712 as EIP712Type,\n        userAddress,\n      });\n    } catch {\n      return null;\n    }\n  }\n\n  static async loadOrSign(\n    instance: FhevmInstance,\n    contractAddresses: string[],\n    signer: ethers.Signer,\n    storage: GenericStringStorage,\n    keyPair?: { publicKey: string; privateKey: string }\n  ): Promise<FhevmDecryptionSignature | null> {\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\n\n    const cached: FhevmDecryptionSignature | null =\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\n        storage,\n        instance,\n        contractAddresses,\n        userAddress,\n        keyPair?.publicKey\n      );\n\n    if (cached) {\n      return cached;\n    }\n\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\n\n    const sig = await FhevmDecryptionSignature.new(\n      instance,\n      contractAddresses,\n      publicKey,\n      privateKey,\n      signer\n    );\n\n    if (!sig) {\n      return null;\n    }\n\n    await sig.saveToGenericStringStorage(\n      storage,\n      instance,\n      Boolean(keyPair?.publicKey)\n    );\n\n    return sig;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1048, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/hooks/useBadges.tsx"],"sourcesContent":["\"use client\";\n\nimport { ethers } from \"ethers\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\n\nconst SKILLFORGE_ABI = [\n  \"function getBadge(uint256 badgeId) view returns (uint256 courseId, address earner, string badgeCID, uint256 claimedAt)\",\n  \"function getBadgeEncryptedScore(uint256 badgeId) view returns (bytes32 encryptedTotalScoreHandle)\",\n  \"function getCourse(uint256 courseId) view returns (address creator, string courseCID, bool active, uint256 forgedAt)\",\n  \"function nextBadgeId() view returns (uint256)\",\n  \"event BadgeClaimed(uint256 indexed badgeId, uint256 indexed courseId, address indexed earner, string badgeCID)\",\n] as const;\n\nexport type Badge = {\n  id: number;\n  courseId: number;\n  earner: string;\n  badgeCID: string;\n  claimedAt: number;\n  decryptedScore?: bigint; // è§£å¯†åŽçš„æœ€ç»ˆåˆ†æ•°ï¼ˆå¯é€‰ï¼‰\n  courseCID?: string; // è¯¾ç¨‹çš„IPFS CIDï¼ˆå¯é€‰ï¼‰\n};\n\nexport function useBadges(parameters: {\n  contractAddress: `0x${string}` | undefined;\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\n  instance: FhevmInstance | undefined;\n  ethersSigner: ethers.JsonRpcSigner | undefined;\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\n  chainId: number | undefined;\n  userAddress?: string; // å¯é€‰ï¼šåªèŽ·å–ç‰¹å®šç”¨æˆ·çš„è¯ä¹¦\n}) {\n  const {\n    contractAddress,\n    ethersReadonlyProvider,\n    instance,\n    ethersSigner,\n    fhevmDecryptionSignatureStorage,\n    chainId,\n    userAddress,\n  } = parameters;\n\n  const [badges, setBadges] = useState<Badge[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const contract = useMemo(() => {\n    if (!contractAddress || !ethersReadonlyProvider) return undefined;\n    return new ethers.Contract(contractAddress, SKILLFORGE_ABI, ethersReadonlyProvider);\n  }, [contractAddress, ethersReadonlyProvider]);\n\n  // èŽ·å–æ‰€æœ‰è¯ä¹¦\n  const fetchBadges = useCallback(async () => {\n    if (!contract) {\n      setBadges([]);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const allBadges: Badge[] = [];\n      \n      try {\n        // é€šè¿‡äº‹ä»¶èŽ·å–æ‰€æœ‰BadgeClaimedäº‹ä»¶\n        const filter = contract.filters.BadgeClaimed();\n        const events = await contract.queryFilter(filter);\n        \n        // ä»Žäº‹ä»¶ä¸­æå–badge IDs\n        const badgeIds = new Set<number>();\n        events.forEach((event) => {\n          if (event.args && event.args.badgeId) {\n            const badgeId = Number(event.args.badgeId);\n            const earner = event.args.earner;\n            // å¦‚æžœæŒ‡å®šäº†userAddressï¼ŒåªèŽ·å–è¯¥ç”¨æˆ·çš„è¯ä¹¦\n            if (!userAddress || earner.toLowerCase() === userAddress.toLowerCase()) {\n              badgeIds.add(badgeId);\n            }\n          }\n        });\n\n        // å¹¶è¡ŒèŽ·å–æ¯ä¸ªè¯ä¹¦çš„è¯¦æƒ…\n        const badgePromises = Array.from(badgeIds).map(async (id) => {\n          try {\n            const [courseId, earner, badgeCID, claimedAt] = await contract.getBadge(id);\n            \n            // å†æ¬¡æ£€æŸ¥ç”¨æˆ·åœ°å€ï¼ˆåŒé‡æ£€æŸ¥ï¼‰\n            if (userAddress && earner.toLowerCase() !== userAddress.toLowerCase()) {\n              return null;\n            }\n\n            // èŽ·å–è·¯å¾„ä¿¡æ¯\n            let courseCID = \"\";\n            try {\n              const [creator, pCID, active, createdAt] = await contract.getCourse(Number(courseId));\n              courseCID = pCID;\n            } catch (e) {\n              console.log(`Error fetching path ${courseId}:`, e);\n            }\n\n            return {\n              id,\n              courseId: Number(courseId),\n              earner,\n              badgeCID,\n              claimedAt: Number(claimedAt),\n              courseCID,\n            } as Badge;\n          } catch (e) {\n            console.log(`Error fetching badge ${id}:`, e);\n            return null;\n          }\n        });\n\n        const results = await Promise.all(badgePromises);\n        results.forEach((badge) => {\n          if (badge) {\n            allBadges.push(badge);\n          }\n        });\n      } catch (e) {\n        console.error(\"Error querying events:\", e);\n        // Fallback: å¦‚æžœäº‹ä»¶æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨nextBadgeId\n        try {\n          const nextId = await contract.nextBadgeId();\n          const totalBadges = Number(nextId);\n          \n          for (let i = 1; i < totalBadges; i++) {\n            try {\n              const [courseId, earner, badgeCID, claimedAt] = await contract.getBadge(i);\n              \n              // å¦‚æžœæŒ‡å®šäº†userAddressï¼ŒåªèŽ·å–è¯¥ç”¨æˆ·çš„è¯ä¹¦\n              if (userAddress && earner.toLowerCase() !== userAddress.toLowerCase()) {\n                continue;\n              }\n\n              // èŽ·å–è·¯å¾„ä¿¡æ¯\n              let courseCID = \"\";\n              try {\n                const [creator, pCID, active, createdAt] = await contract.getCourse(Number(courseId));\n                courseCID = pCID;\n              } catch (e) {\n                console.log(`Error fetching path ${courseId}:`, e);\n              }\n\n              allBadges.push({\n                id: i,\n                courseId: Number(courseId),\n                earner,\n                badgeCID,\n                claimedAt: Number(claimedAt),\n                courseCID,\n              });\n            } catch (e) {\n              // è·³è¿‡ä¸å­˜åœ¨çš„è¯ä¹¦\n            }\n          }\n        } catch (fallbackError) {\n          console.error(\"Fallback method also failed:\", fallbackError);\n        }\n      }\n\n      // æŒ‰é“¸é€ æ—¶é—´å€’åºæŽ’åˆ—\n      allBadges.sort((a, b) => b.claimedAt - a.claimedAt);\n\n      setBadges(allBadges);\n    } catch (e: any) {\n      console.error(\"Error fetching badges:\", e);\n      setError(e.message || \"Failed to fetch badges\");\n    } finally {\n      setIsLoading(false);\n    }\n  }, [contract, userAddress]);\n\n  // èŽ·å–å•ä¸ªè¯ä¹¦è¯¦æƒ…\n  const fetchBadge = useCallback(\n    async (badgeId: number): Promise<Badge | null> => {\n      if (!contract) return null;\n\n      try {\n        const [courseId, earner, badgeCID, claimedAt] = await contract.getBadge(badgeId);\n\n        // èŽ·å–è·¯å¾„ä¿¡æ¯\n        let courseCID = \"\";\n        try {\n          const [creator, pCID, active, createdAt] = await contract.getCourse(Number(courseId));\n          courseCID = pCID;\n        } catch (e) {\n          console.log(`Error fetching path ${courseId}:`, e);\n        }\n\n        return {\n          id: badgeId,\n          courseId: Number(courseId),\n          earner,\n          badgeCID,\n          claimedAt: Number(claimedAt),\n          courseCID,\n        };\n      } catch (e: any) {\n        console.error(`Error fetching badge ${badgeId}:`, e);\n        return null;\n      }\n    },\n    [contract]\n  );\n\n  // è§£å¯†è¯ä¹¦åˆ†æ•°\n  const decryptBadgeScore = useCallback(\n    async (badgeId: number): Promise<bigint | null> => {\n      if (!instance || !ethersSigner || !contractAddress || !contract) {\n        return null;\n      }\n\n      try {\n        // èŽ·å–è¯ä¹¦çš„åŠ å¯†åˆ†æ•°handle\n        const encryptedScoreHandle = await contract.getBadgeEncryptedScore(badgeId);\n        \n        // å°†handleè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼\n        const handle = typeof encryptedScoreHandle === 'string' \n          ? encryptedScoreHandle \n          : ethers.hexlify(encryptedScoreHandle);\n\n        // æž„å»ºè§£å¯†ç­¾å\n        const sig = await FhevmDecryptionSignature.loadOrSign(\n          instance,\n          [contractAddress],\n          ethersSigner,\n          fhevmDecryptionSignatureStorage\n        );\n\n        if (!sig) {\n          return null;\n        }\n\n        // è§£å¯†\n        const res = await instance.userDecrypt(\n          [{ handle, contractAddress }],\n          sig.privateKey,\n          sig.publicKey,\n          sig.signature,\n          sig.contractAddresses,\n          sig.userAddress,\n          sig.startTimestamp,\n          sig.durationDays\n        );\n\n        return res[handle] || null;\n      } catch (e) {\n        console.error(\"Error decrypting badge score:\", e);\n        return null;\n      }\n    },\n    [instance, ethersSigner, contractAddress, fhevmDecryptionSignatureStorage, contract]\n  );\n\n  // ä¸ºè¯ä¹¦è§£å¯†åˆ†æ•°å¹¶æ›´æ–°çŠ¶æ€\n  const decryptAndUpdateBadge = useCallback(\n    async (badgeId: number) => {\n      const score = await decryptBadgeScore(badgeId);\n      if (score !== null) {\n        setBadges((prev) =>\n          prev.map((badge) =>\n            badge.id === badgeId ? { ...badge, decryptedScore: score } : badge\n          )\n        );\n      }\n      return score;\n    },\n    [decryptBadgeScore]\n  );\n\n  // ç›‘å¬äº‹ä»¶\n  useEffect(() => {\n    if (!contract || !ethersReadonlyProvider) return;\n\n    const filter = contract.filters.BadgeClaimed();\n\n    const handleClaimed = () => {\n      console.log(\"New badge claimed, refreshing...\");\n      fetchBadges();\n    };\n\n    // ç›‘å¬äº‹ä»¶\n    contract.on(filter, handleClaimed);\n\n    // åˆå§‹åŠ è½½\n    fetchBadges();\n\n    return () => {\n      contract.off(filter, handleClaimed);\n    };\n  }, [contract, ethersReadonlyProvider, fetchBadges]);\n\n  return {\n    badges,\n    isLoading,\n    error,\n    fetchBadges,\n    fetchBadge,\n    decryptBadgeScore,\n    decryptAndUpdateBadge,\n  };\n}\n\n"],"names":[],"mappings":";;;;AAEA;AACA;AAEA;AALA;;;;AAQA,MAAM,iBAAiB;IACrB;IACA;IACA;IACA;IACA;CACD;AAYM,SAAS,UAAU,UAQzB;IACC,MAAM,EACJ,eAAe,EACf,sBAAsB,EACtB,QAAQ,EACR,YAAY,EACZ,+BAA+B,EAC/B,OAAO,EACP,WAAW,EACZ,GAAG;IAEJ,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAU,EAAE;IAChD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAElD,MAAM,WAAW,IAAA,gNAAO,EAAC;QACvB,IAAI,CAAC,mBAAmB,CAAC,wBAAwB,OAAO;QACxD,OAAO,IAAI,0LAAM,CAAC,QAAQ,CAAC,iBAAiB,gBAAgB;IAC9D,GAAG;QAAC;QAAiB;KAAuB;IAE5C,SAAS;IACT,MAAM,cAAc,IAAA,oNAAW,EAAC;QAC9B,IAAI,CAAC,UAAU;YACb,UAAU,EAAE;YACZ;QACF;QAEA,aAAa;QACb,SAAS;QAET,IAAI;YACF,MAAM,YAAqB,EAAE;YAE7B,IAAI;gBACF,yBAAyB;gBACzB,MAAM,SAAS,SAAS,OAAO,CAAC,YAAY;gBAC5C,MAAM,SAAS,MAAM,SAAS,WAAW,CAAC;gBAE1C,kBAAkB;gBAClB,MAAM,WAAW,IAAI;gBACrB,OAAO,OAAO,CAAC,CAAC;oBACd,IAAI,MAAM,IAAI,IAAI,MAAM,IAAI,CAAC,OAAO,EAAE;wBACpC,MAAM,UAAU,OAAO,MAAM,IAAI,CAAC,OAAO;wBACzC,MAAM,SAAS,MAAM,IAAI,CAAC,MAAM;wBAChC,6BAA6B;wBAC7B,IAAI,CAAC,eAAe,OAAO,WAAW,OAAO,YAAY,WAAW,IAAI;4BACtE,SAAS,GAAG,CAAC;wBACf;oBACF;gBACF;gBAEA,cAAc;gBACd,MAAM,gBAAgB,MAAM,IAAI,CAAC,UAAU,GAAG,CAAC,OAAO;oBACpD,IAAI;wBACF,MAAM,CAAC,UAAU,QAAQ,UAAU,UAAU,GAAG,MAAM,SAAS,QAAQ,CAAC;wBAExE,iBAAiB;wBACjB,IAAI,eAAe,OAAO,WAAW,OAAO,YAAY,WAAW,IAAI;4BACrE,OAAO;wBACT;wBAEA,SAAS;wBACT,IAAI,YAAY;wBAChB,IAAI;4BACF,MAAM,CAAC,SAAS,MAAM,QAAQ,UAAU,GAAG,MAAM,SAAS,SAAS,CAAC,OAAO;4BAC3E,YAAY;wBACd,EAAE,OAAO,GAAG;4BACV,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,SAAS,CAAC,CAAC,EAAE;wBAClD;wBAEA,OAAO;4BACL;4BACA,UAAU,OAAO;4BACjB;4BACA;4BACA,WAAW,OAAO;4BAClB;wBACF;oBACF,EAAE,OAAO,GAAG;wBACV,QAAQ,GAAG,CAAC,CAAC,qBAAqB,EAAE,GAAG,CAAC,CAAC,EAAE;wBAC3C,OAAO;oBACT;gBACF;gBAEA,MAAM,UAAU,MAAM,QAAQ,GAAG,CAAC;gBAClC,QAAQ,OAAO,CAAC,CAAC;oBACf,IAAI,OAAO;wBACT,UAAU,IAAI,CAAC;oBACjB;gBACF;YACF,EAAE,OAAO,GAAG;gBACV,QAAQ,KAAK,CAAC,0BAA0B;gBACxC,qCAAqC;gBACrC,IAAI;oBACF,MAAM,SAAS,MAAM,SAAS,WAAW;oBACzC,MAAM,cAAc,OAAO;oBAE3B,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,IAAK;wBACpC,IAAI;4BACF,MAAM,CAAC,UAAU,QAAQ,UAAU,UAAU,GAAG,MAAM,SAAS,QAAQ,CAAC;4BAExE,6BAA6B;4BAC7B,IAAI,eAAe,OAAO,WAAW,OAAO,YAAY,WAAW,IAAI;gCACrE;4BACF;4BAEA,SAAS;4BACT,IAAI,YAAY;4BAChB,IAAI;gCACF,MAAM,CAAC,SAAS,MAAM,QAAQ,UAAU,GAAG,MAAM,SAAS,SAAS,CAAC,OAAO;gCAC3E,YAAY;4BACd,EAAE,OAAO,GAAG;gCACV,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,SAAS,CAAC,CAAC,EAAE;4BAClD;4BAEA,UAAU,IAAI,CAAC;gCACb,IAAI;gCACJ,UAAU,OAAO;gCACjB;gCACA;gCACA,WAAW,OAAO;gCAClB;4BACF;wBACF,EAAE,OAAO,GAAG;wBACV,WAAW;wBACb;oBACF;gBACF,EAAE,OAAO,eAAe;oBACtB,QAAQ,KAAK,CAAC,gCAAgC;gBAChD;YACF;YAEA,YAAY;YACZ,UAAU,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;YAElD,UAAU;QACZ,EAAE,OAAO,GAAQ;YACf,QAAQ,KAAK,CAAC,0BAA0B;YACxC,SAAS,EAAE,OAAO,IAAI;QACxB,SAAU;YACR,aAAa;QACf;IACF,GAAG;QAAC;QAAU;KAAY;IAE1B,WAAW;IACX,MAAM,aAAa,IAAA,oNAAW,EAC5B,OAAO;QACL,IAAI,CAAC,UAAU,OAAO;QAEtB,IAAI;YACF,MAAM,CAAC,UAAU,QAAQ,UAAU,UAAU,GAAG,MAAM,SAAS,QAAQ,CAAC;YAExE,SAAS;YACT,IAAI,YAAY;YAChB,IAAI;gBACF,MAAM,CAAC,SAAS,MAAM,QAAQ,UAAU,GAAG,MAAM,SAAS,SAAS,CAAC,OAAO;gBAC3E,YAAY;YACd,EAAE,OAAO,GAAG;gBACV,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,SAAS,CAAC,CAAC,EAAE;YAClD;YAEA,OAAO;gBACL,IAAI;gBACJ,UAAU,OAAO;gBACjB;gBACA;gBACA,WAAW,OAAO;gBAClB;YACF;QACF,EAAE,OAAO,GAAQ;YACf,QAAQ,KAAK,CAAC,CAAC,qBAAqB,EAAE,QAAQ,CAAC,CAAC,EAAE;YAClD,OAAO;QACT;IACF,GACA;QAAC;KAAS;IAGZ,SAAS;IACT,MAAM,oBAAoB,IAAA,oNAAW,EACnC,OAAO;QACL,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,UAAU;YAC/D,OAAO;QACT;QAEA,IAAI;YACF,kBAAkB;YAClB,MAAM,uBAAuB,MAAM,SAAS,sBAAsB,CAAC;YAEnE,kBAAkB;YAClB,MAAM,SAAS,OAAO,yBAAyB,WAC3C,uBACA,0LAAM,CAAC,OAAO,CAAC;YAEnB,SAAS;YACT,MAAM,MAAM,MAAM,6JAAwB,CAAC,UAAU,CACnD,UACA;gBAAC;aAAgB,EACjB,cACA;YAGF,IAAI,CAAC,KAAK;gBACR,OAAO;YACT;YAEA,KAAK;YACL,MAAM,MAAM,MAAM,SAAS,WAAW,CACpC;gBAAC;oBAAE;oBAAQ;gBAAgB;aAAE,EAC7B,IAAI,UAAU,EACd,IAAI,SAAS,EACb,IAAI,SAAS,EACb,IAAI,iBAAiB,EACrB,IAAI,WAAW,EACf,IAAI,cAAc,EAClB,IAAI,YAAY;YAGlB,OAAO,GAAG,CAAC,OAAO,IAAI;QACxB,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,OAAO;QACT;IACF,GACA;QAAC;QAAU;QAAc;QAAiB;QAAiC;KAAS;IAGtF,eAAe;IACf,MAAM,wBAAwB,IAAA,oNAAW,EACvC,OAAO;QACL,MAAM,QAAQ,MAAM,kBAAkB;QACtC,IAAI,UAAU,MAAM;YAClB,UAAU,CAAC,OACT,KAAK,GAAG,CAAC,CAAC,QACR,MAAM,EAAE,KAAK,UAAU;wBAAE,GAAG,KAAK;wBAAE,gBAAgB;oBAAM,IAAI;QAGnE;QACA,OAAO;IACT,GACA;QAAC;KAAkB;IAGrB,OAAO;IACP,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,YAAY,CAAC,wBAAwB;QAE1C,MAAM,SAAS,SAAS,OAAO,CAAC,YAAY;QAE5C,MAAM,gBAAgB;YACpB,QAAQ,GAAG,CAAC;YACZ;QACF;QAEA,OAAO;QACP,SAAS,EAAE,CAAC,QAAQ;QAEpB,OAAO;QACP;QAEA,OAAO;YACL,SAAS,GAAG,CAAC,QAAQ;QACvB;IACF,GAAG;QAAC;QAAU;QAAwB;KAAY;IAElD,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 1300, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/app/badges/page.tsx"],"sourcesContent":["\"use client\";\n\nimport WalletGuard from \"@/components/WalletGuard\";\nimport { useMetaMaskEthersSigner } from \"@/hooks/metamask/useMetaMaskEthersSigner\";\nimport { useFhevm } from \"@/fhevm/useFhevm\";\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\nimport { useBadges } from \"@/hooks/useBadges\";\n\nconst CONTRACT_ADDRESS = \"0x5FbDB2315678afecb367f032d93F642f64180aa3\" as `0x${string}`;\n\nexport default function BadgesPage() {\n  const { storage } = useInMemoryStorage();\n  const { provider, chainId, ethersSigner, ethersReadonlyProvider, initialMockChains, isConnected, accounts } = useMetaMaskEthersSigner();\n  const { instance: fhevmInstance } = useFhevm({ provider, chainId, initialMockChains, enabled: isConnected });\n  const { badges, isLoading } = useBadges({ contractAddress: CONTRACT_ADDRESS, ethersReadonlyProvider, instance: fhevmInstance, ethersSigner, fhevmDecryptionSignatureStorage: storage, chainId, userAddress: accounts[0] });\n\n  return (\n    <WalletGuard>\n      <div className=\"min-h-[calc(100vh-5rem)] py-12\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"mb-12 text-center\">\n            <div className=\"inline-flex items-center space-x-3 mb-4\">\n              <div className=\"h-1 w-8 bg-gradient-purple rounded-full\"></div>\n              <span className=\"text-5xl animate-float\">ðŸ†</span>\n              <div className=\"h-1 w-8 bg-gradient-purple rounded-full\"></div>\n            </div>\n            <h1 className=\"text-5xl font-display font-black mb-3\">\n              <span className=\"gradient-text\">My Badges</span>\n            </h1>\n            <p className=\"text-white/80 text-lg\">Your forged achievement badges</p>\n          </div>\n\n          {isLoading ? (\n            <div className=\"text-center py-12\">\n              <div className=\"inline-block h-12 w-12 border-4 border-white/20 border-t-primary rounded-full animate-spin\"></div>\n              <p className=\"text-white/70 mt-4\">Loading...</p>\n            </div>\n          ) : badges.length === 0 ? (\n            <div className=\"text-center py-16\">\n              <div className=\"glass-strong rounded-3xl p-12 max-w-md mx-auto\">\n                <div className=\"text-7xl mb-6 animate-float\">ðŸ…</div>\n                <h3 className=\"text-2xl font-bold text-white mb-3\">No Badges Yet</h3>\n                <p className=\"text-white/60\">Complete course challenges to claim badges</p>\n              </div>\n            </div>\n          ) : (\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {badges.map((badge, index) => (\n                <div key={badge.id} className=\"glass-card rounded-3xl p-6 shadow-glass hover:shadow-glass-lg transition-all\" style={{animationDelay: `${index * 0.1}s`}}>\n                  <div className=\"text-center mb-4\">\n                    <div className=\"inline-flex h-24 w-24 items-center justify-center rounded-3xl bg-gradient-purple text-5xl mb-4 shadow-glow transform group-hover:scale-110 transition-transform animate-float\" style={{animationDelay: `${index * 0.2}s`}}>\n                      ðŸ†\n                    </div>\n                    <h3 className=\"text-2xl font-display font-black gradient-text\">Badge #{badge.id}</h3>\n                  </div>\n                  <div className=\"space-y-3 text-sm\">\n                    <div className=\"glass-dark rounded-xl p-3\">\n                      <p className=\"text-white/60 text-xs mb-1\">Course</p>\n                      <p className=\"text-white font-bold\">#{badge.courseId}</p>\n                    </div>\n                    <div className=\"glass-dark rounded-xl p-3\">\n                      <p className=\"text-white/60 text-xs mb-1\">Owner</p>\n                      <p className=\"text-white font-mono text-xs\">{badge.earner ? `${badge.earner.slice(0, 16)}...` : 'Unknown'}</p>\n                    </div>\n                    <div className=\"glass-dark rounded-xl p-3\">\n                      <p className=\"text-white/60 text-xs mb-1\">Claimed At</p>\n                      <p className=\"text-white\">{badge.claimedAt ? new Date(badge.claimedAt * 1000).toLocaleDateString('en-US') : 'Unknown'}</p>\n                    </div>\n                    {badge.decryptedScore && (\n                      <div className=\"glass-dark rounded-xl p-3 border border-primary/30\">\n                        <p className=\"text-primary font-bold text-lg\">ðŸ’Ž Total Score: {badge.decryptedScore.toString()}</p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </WalletGuard>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1643, "column": 0}, "map": {"version":3,"sources":["file:///Users/toolboxb/Desktop/ZAMA/%E5%8D%81%E4%B8%80%E6%9C%88%E9%A1%B9%E7%9B%AE/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%81%E6%98%8E/%E8%AF%AD%E8%A8%8002/action/frontend/node_modules/idb/build/index.js"],"sourcesContent":["const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst transactionDoneMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    // This mapping exists in reverseTransformCache but doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(this.request);\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nconst advanceMethodProps = ['continue', 'continuePrimaryKey', 'advance'];\nconst methodMap = {};\nconst advanceResults = new WeakMap();\nconst ittrProxiedCursorToOriginalProxy = new WeakMap();\nconst cursorIteratorTraps = {\n    get(target, prop) {\n        if (!advanceMethodProps.includes(prop))\n            return target[prop];\n        let cachedFunc = methodMap[prop];\n        if (!cachedFunc) {\n            cachedFunc = methodMap[prop] = function (...args) {\n                advanceResults.set(this, ittrProxiedCursorToOriginalProxy.get(this)[prop](...args));\n            };\n        }\n        return cachedFunc;\n    },\n};\nasync function* iterate(...args) {\n    // tslint:disable-next-line:no-this-assignment\n    let cursor = this;\n    if (!(cursor instanceof IDBCursor)) {\n        cursor = await cursor.openCursor(...args);\n    }\n    if (!cursor)\n        return;\n    cursor = cursor;\n    const proxiedCursor = new Proxy(cursor, cursorIteratorTraps);\n    ittrProxiedCursorToOriginalProxy.set(proxiedCursor, cursor);\n    // Map this double-proxy back to the original, so other cursor methods work.\n    reverseTransformCache.set(proxiedCursor, unwrap(cursor));\n    while (cursor) {\n        yield proxiedCursor;\n        // If one of the advancing methods was not called, call continue().\n        cursor = await (advanceResults.get(proxiedCursor) || cursor.continue());\n        advanceResults.delete(proxiedCursor);\n    }\n}\nfunction isIteratorProp(target, prop) {\n    return ((prop === Symbol.asyncIterator &&\n        instanceOfAny(target, [IDBIndex, IDBObjectStore, IDBCursor])) ||\n        (prop === 'iterate' && instanceOfAny(target, [IDBIndex, IDBObjectStore])));\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get(target, prop, receiver) {\n        if (isIteratorProp(target, prop))\n            return iterate;\n        return oldTraps.get(target, prop, receiver);\n    },\n    has(target, prop) {\n        return isIteratorProp(target, prop) || oldTraps.has(target, prop);\n    },\n}));\n\nexport { deleteDB, openDB, unwrap, wrap };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}}]
}